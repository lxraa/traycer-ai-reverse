"use strict";var rt=Object.create;var me=Object.defineProperty;var nt=Object.getOwnPropertyDescriptor;var ot=Object.getOwnPropertyNames;var it=Object.getPrototypeOf,st=Object.prototype.hasOwnProperty;var W=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var ut=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of ot(t))!st.call(e,o)&&o!==r&&me(e,o,{get:()=>t[o],enumerable:!(n=nt(t,o))||n.enumerable});return e};var he=(e,t,r)=>(r=e!=null?rt(it(e)):{},ut(t||!e||!e.__esModule?me(r,"default",{value:e,enumerable:!0}):r,e));var X=W((Nt,A)=>{var we=function(e){return typeof e<"u"&&e.versions!=null&&e.versions.node!=null&&e+""=="[object process]"};A.exports.isNode=we;A.exports.platform=typeof process<"u"&&we(process)?"node":"browser";var pe=A.exports.platform==="node"&&require("worker_threads");A.exports.isMainThread=A.exports.platform==="node"?(!pe||pe.isMainThread)&&!process.connected:typeof Window<"u";A.exports.cpus=A.exports.platform==="browser"?self.navigator.hardwareConcurrency:require("os").cpus().length});var H=W(ke=>{"use strict";function L(e,t){var r=this;if(!(this instanceof L))throw new SyntaxError("Constructor must be called with the new operator");if(typeof e!="function")throw new SyntaxError("Function parameter handler(resolve, reject) missing");var n=[],o=[];this.resolved=!1,this.rejected=!1,this.pending=!0,this[Symbol.toStringTag]="Promise";var s=function(u,f){n.push(u),o.push(f)};this.then=function(u,f){return new L(function(l,m){var O=u?ge(u,l,m):l,h=f?ge(f,l,m):m;s(O,h)},r)};var a=function(u){return r.resolved=!0,r.rejected=!1,r.pending=!1,n.forEach(function(f){f(u)}),s=function(f,l){f(u)},a=i=function(){},r},i=function(u){return r.resolved=!1,r.rejected=!0,r.pending=!1,o.forEach(function(f){f(u)}),s=function(f,l){l(u)},a=i=function(){},r};this.cancel=function(){return t?t.cancel():i(new R),r},this.timeout=function(u){if(t)t.timeout(u);else{var f=setTimeout(function(){i(new D("Promise timed out after "+u+" ms"))},u);r.always(function(){clearTimeout(f)})}return r},e(function(u){a(u)},function(u){i(u)})}function ge(e,t,r){return function(n){try{var o=e(n);o&&typeof o.then=="function"&&typeof o.catch=="function"?o.then(t,r):t(o)}catch(s){r(s)}}}L.prototype.catch=function(e){return this.then(null,e)};L.prototype.always=function(e){return this.then(e,e)};L.prototype.finally=function(e){let t=this,r=function(){return new L(n=>n()).then(e).then(()=>t)};return this.then(r,r)};L.all=function(e){return new L(function(t,r){var n=e.length,o=[];n?e.forEach(function(s,a){s.then(function(i){o[a]=i,n--,n==0&&t(o)},function(i){n=0,r(i)})}):t(o)})};L.defer=function(){var e={};return e.promise=new L(function(t,r){e.resolve=t,e.reject=r}),e};function R(e){this.message=e||"promise cancelled",this.stack=new Error().stack}R.prototype=new Error;R.prototype.constructor=Error;R.prototype.name="CancellationError";L.CancellationError=R;function D(e){this.message=e||"timeout exceeded",this.stack=new Error().stack}D.prototype=new Error;D.prototype.constructor=Error;D.prototype.name="TimeoutError";L.TimeoutError=D;ke.Promise=L});var ve=W(U=>{U.validateOptions=function(t,r,n){if(t){var o=t?Object.keys(t):[],s=o.find(i=>!r.includes(i));if(s)throw new Error('Object "'+n+'" contains an unknown option "'+s+'"');var a=r.find(i=>Object.prototype[i]&&!o.includes(i));if(a)throw new Error('Object "'+n+'" contains an inherited option "'+a+'" which is not defined in the object itself but in its prototype. Only plain objects are allowed. Please remove the option from the prototype or override it with a value "undefined".');return t}};U.workerOptsNames=["credentials","name","type"];U.forkOptsNames=["cwd","detached","env","execPath","execArgv","gid","serialization","signal","killSignal","silent","stdio","uid","windowsVerbatimArguments","timeout"];U.workerThreadOptsNames=["argv","env","eval","execArgv","stdin","stdout","stderr","workerData","trackUnmanagedFds","transferList","resourceLimits","name"]});var be=W((Ht,ye)=>{ye.exports=`!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).worker=n()}(this,(function(){"use strict";function e(n){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(n)}function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var t={};var r=function(e,n){this.message=e,this.transfer=n},o={};function i(e,n){var t=this;if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if("function"!=typeof e)throw new SyntaxError("Function parameter handler(resolve, reject) missing");var r=[],o=[];this.resolved=!1,this.rejected=!1,this.pending=!0,this[Symbol.toStringTag]="Promise";var a=function(e,n){r.push(e),o.push(n)};this.then=function(e,n){return new i((function(t,r){var o=e?s(e,t,r):t,i=n?s(n,t,r):r;a(o,i)}),t)};var f=function(e){return t.resolved=!0,t.rejected=!1,t.pending=!1,r.forEach((function(n){n(e)})),a=function(n,t){n(e)},f=d=function(){},t},d=function(e){return t.resolved=!1,t.rejected=!0,t.pending=!1,o.forEach((function(n){n(e)})),a=function(n,t){t(e)},f=d=function(){},t};this.cancel=function(){return n?n.cancel():d(new u),t},this.timeout=function(e){if(n)n.timeout(e);else{var r=setTimeout((function(){d(new c("Promise timed out after "+e+" ms"))}),e);t.always((function(){clearTimeout(r)}))}return t},e((function(e){f(e)}),(function(e){d(e)}))}function s(e,n,t){return function(r){try{var o=e(r);o&&"function"==typeof o.then&&"function"==typeof o.catch?o.then(n,t):n(o)}catch(e){t(e)}}}function u(e){this.message=e||"promise cancelled",this.stack=(new Error).stack}function c(e){this.message=e||"timeout exceeded",this.stack=(new Error).stack}return i.prototype.catch=function(e){return this.then(null,e)},i.prototype.always=function(e){return this.then(e,e)},i.prototype.finally=function(e){var n=this,t=function(){return new i((function(e){return e()})).then(e).then((function(){return n}))};return this.then(t,t)},i.all=function(e){return new i((function(n,t){var r=e.length,o=[];r?e.forEach((function(e,i){e.then((function(e){o[i]=e,0==--r&&n(o)}),(function(e){r=0,t(e)}))})):n(o)}))},i.defer=function(){var e={};return e.promise=new i((function(n,t){e.resolve=n,e.reject=t})),e},u.prototype=new Error,u.prototype.constructor=Error,u.prototype.name="CancellationError",i.CancellationError=u,c.prototype=new Error,c.prototype.constructor=Error,c.prototype.name="TimeoutError",i.TimeoutError=c,o.Promise=i,function(n){var t=r,i=o.Promise,s="__workerpool-cleanup__",u={exit:function(){}},c={addAbortListener:function(e){u.abortListeners.push(e)},emit:u.emit};if("undefined"!=typeof self&&"function"==typeof postMessage&&"function"==typeof addEventListener)u.on=function(e,n){addEventListener(e,(function(e){n(e.data)}))},u.send=function(e,n){n?postMessage(e,n):postMessage(e)};else{if("undefined"==typeof process)throw new Error("Script must be executed as a worker");var a;try{a=require("worker_threads")}catch(n){if("object"!==e(n)||null===n||"MODULE_NOT_FOUND"!==n.code)throw n}if(a&&null!==a.parentPort){var f=a.parentPort;u.send=f.postMessage.bind(f),u.on=f.on.bind(f),u.exit=process.exit.bind(process)}else u.on=process.on.bind(process),u.send=function(e){process.send(e)},u.on("disconnect",(function(){process.exit(1)})),u.exit=process.exit.bind(process)}function d(e){return e&&e.toJSON?JSON.parse(JSON.stringify(e)):JSON.parse(JSON.stringify(e,Object.getOwnPropertyNames(e)))}function l(e){return e&&"function"==typeof e.then&&"function"==typeof e.catch}u.methods={},u.methods.run=function(e,n){var t=new Function("return ("+e+").apply(this, arguments);");return t.worker=c,t.apply(t,n)},u.methods.methods=function(){return Object.keys(u.methods)},u.terminationHandler=void 0,u.abortListenerTimeout=1e3,u.abortListeners=[],u.terminateAndExit=function(e){var n=function(){u.exit(e)};if(!u.terminationHandler)return n();var t=u.terminationHandler(e);return l(t)?(t.then(n,n),t):(n(),new i((function(e,n){n(new Error("Worker terminating"))})))},u.cleanup=function(e){if(!u.abortListeners.length)return u.send({id:e,method:s,error:d(new Error("Worker terminating"))}),new i((function(e){e()}));var n,t=u.abortListeners.map((function(e){return e()})),r=new i((function(e,t){n=setTimeout((function(){t(new Error("Timeout occured waiting for abort handler, killing worker"))}),u.abortListenerTimeout)})),o=i.all(t).then((function(){clearTimeout(n),u.abortListeners.length||(u.abortListeners=[])}),(function(){clearTimeout(n),u.exit()}));return new i((function(e,n){o.then(e,n),r.then(e,n)})).then((function(){u.send({id:e,method:s,error:null})}),(function(n){u.send({id:e,method:s,error:n?d(n):null})}))};var p=null;u.on("message",(function(e){if("__workerpool-terminate__"===e)return u.terminateAndExit(0);if(e.method===s)return u.cleanup(e.id);try{var n=u.methods[e.method];if(!n)throw new Error('Unknown method "'+e.method+'"');p=e.id;var r=n.apply(n,e.params);l(r)?r.then((function(n){n instanceof t?u.send({id:e.id,result:n.message,error:null},n.transfer):u.send({id:e.id,result:n,error:null}),p=null})).catch((function(n){u.send({id:e.id,result:null,error:d(n)}),p=null})):(r instanceof t?u.send({id:e.id,result:r.message,error:null},r.transfer):u.send({id:e.id,result:r,error:null}),p=null)}catch(n){u.send({id:e.id,result:null,error:d(n)})}})),u.register=function(e,n){if(e)for(var t in e)e.hasOwnProperty(t)&&(u.methods[t]=e[t],u.methods[t].worker=c);n&&(u.terminationHandler=n.onTerminate,u.abortListenerTimeout=n.abortListenerTimeout||1e3),u.send("ready")},u.emit=function(e){if(p){if(e instanceof t)return void u.send({id:p,isEvent:!0,payload:e.message},e.transfer);u.send({id:p,isEvent:!0,payload:e})}},n.add=u.register,n.emit=u.emit}(t),n(t)}));
//# sourceMappingURL=worker.min.js.map
`});var je=W((Ut,C)=>{"use strict";var{Promise:q}=H(),We=X(),{validateOptions:te,forkOptsNames:at,workerThreadOptsNames:ft,workerOptsNames:ct}=ve(),Oe="__workerpool-terminate__",Pe="__workerpool-cleanup__";function _e(){var e=re();if(!e)throw new Error("WorkerPool: workerType = 'thread' is not supported, Node >= 11.7.0 required");return e}function Te(){if(typeof Worker!="function"&&(typeof Worker!="object"||typeof Worker.prototype.constructor!="function"))throw new Error("WorkerPool: Web Workers not supported")}function re(){try{return require("worker_threads")}catch(e){if(typeof e=="object"&&e!==null&&e.code==="MODULE_NOT_FOUND")return null;throw e}}function lt(){if(We.platform==="browser"){if(typeof Blob>"u")throw new Error("Blob not supported by the browser");if(!window.URL||typeof window.URL.createObjectURL!="function")throw new Error("URL.createObjectURL not supported by the browser");var e=new Blob([be()],{type:"text/javascript"});return window.URL.createObjectURL(e)}else return __dirname+"/worker.js"}function dt(e,t){if(t.workerType==="web")return Te(),Z(e,t.workerOpts,Worker);if(t.workerType==="thread")return r=_e(),$(e,r,t);if(t.workerType==="process"||!t.workerType)return ee(e,xe(t),require("child_process"));if(We.platform==="browser")return Te(),Z(e,t.workerOpts,Worker);var r=re();return r?$(e,r,t):ee(e,xe(t),require("child_process"))}function Z(e,t,r){te(t,ct,"workerOpts");var n=new r(e,t);return n.isBrowserWorker=!0,n.on=function(o,s){this.addEventListener(o,function(a){s(a.data)})},n.send=function(o,s){this.postMessage(o,s)},n}function $(e,t,r){te(r?.workerThreadOpts,ft,"workerThreadOpts");var n=new t.Worker(e,{stdout:r?.emitStdStreams??!1,stderr:r?.emitStdStreams??!1,...r?.workerThreadOpts});return n.isWorkerThread=!0,n.send=function(o,s){this.postMessage(o,s)},n.kill=function(){return this.terminate(),!0},n.disconnect=function(){this.terminate()},r?.emitStdStreams&&(n.stdout.on("data",o=>n.emit("stdout",o)),n.stderr.on("data",o=>n.emit("stderr",o))),n}function ee(e,t,r){te(t.forkOpts,at,"forkOpts");var n=r.fork(e,t.forkArgs,t.forkOpts),o=n.send;return n.send=function(s){return o.call(n,s)},t.emitStdStreams&&(n.stdout.on("data",s=>n.emit("stdout",s)),n.stderr.on("data",s=>n.emit("stderr",s))),n.isChildProcess=!0,n}function xe(e){e=e||{};var t=process.execArgv.join(" "),r=t.indexOf("--inspect")!==-1,n=t.indexOf("--debug-brk")!==-1,o=[];return r&&(o.push("--inspect="+e.debugPort),n&&o.push("--debug-brk")),process.execArgv.forEach(function(s){s.indexOf("--max-old-space-size")>-1&&o.push(s)}),Object.assign({},e,{forkArgs:e.forkArgs,forkOpts:Object.assign({},e.forkOpts,{execArgv:(e.forkOpts&&e.forkOpts.execArgv||[]).concat(o),stdio:e.emitStdStreams?"pipe":void 0})})}function Ee(e){for(var t=new Error(""),r=Object.keys(e),n=0;n<r.length;n++)t[r[n]]=e[r[n]];return t}function Le(e,t){Object.values(e.processing).forEach(r=>r?.options?.on(t)),Object.values(e.tracking).forEach(r=>r?.options?.on(t))}function N(e,t){var r=this,n=t||{};this.script=e||lt(),this.worker=dt(this.script,n),this.debugPort=n.debugPort,this.forkOpts=n.forkOpts,this.forkArgs=n.forkArgs,this.workerOpts=n.workerOpts,this.workerThreadOpts=n.workerThreadOpts,this.workerTerminateTimeout=n.workerTerminateTimeout,e||(this.worker.ready=!0),this.requestQueue=[],this.worker.on("stdout",function(i){Le(r,{stdout:i.toString()})}),this.worker.on("stderr",function(i){Le(r,{stderr:i.toString()})}),this.worker.on("message",function(i){if(!r.terminated)if(typeof i=="string"&&i==="ready")r.worker.ready=!0,s();else{var u=i.id,f=r.processing[u];if(f!==void 0)i.isEvent?f.options&&typeof f.options.on=="function"&&f.options.on(i.payload):(delete r.processing[u],r.terminating===!0&&r.terminate(),i.error?f.resolver.reject(Ee(i.error)):f.resolver.resolve(i.result));else{var f=r.tracking[u];f!==void 0&&i.isEvent&&f.options&&typeof f.options.on=="function"&&f.options.on(i.payload)}if(i.method===Pe){var l=r.tracking[i.id];l!==void 0&&(i.error?(clearTimeout(l.timeoutId),l.resolver.reject(Ee(i.error))):(r.tracking&&clearTimeout(l.timeoutId),l.resolver.reject(new Se(l.error)))),delete r.tracking[u]}}});function o(i){r.terminated=!0;for(var u in r.processing)r.processing[u]!==void 0&&r.processing[u].resolver.reject(i);r.processing=Object.create(null)}function s(){for(let i of r.requestQueue.splice(0))r.worker.send(i.message,i.transfer)}var a=this.worker;this.worker.on("error",o),this.worker.on("exit",function(i,u){var f=`Workerpool Worker terminated Unexpectedly
`;f+="    exitCode: `"+i+"`\n",f+="    signalCode: `"+u+"`\n",f+="    workerpool.script: `"+r.script+"`\n",f+="    spawnArgs: `"+a.spawnargs+"`\n",f+="    spawnfile: `"+a.spawnfile+"`\n",f+="    stdout: `"+a.stdout+"`\n",f+="    stderr: `"+a.stderr+"`\n",o(new Error(f))}),this.processing=Object.create(null),this.tracking=Object.create(null),this.terminating=!1,this.terminated=!1,this.cleaning=!1,this.terminationHandler=null,this.lastId=0}N.prototype.methods=function(){return this.exec("methods")};N.prototype.exec=function(e,t,r,n){r||(r=q.defer());var o=++this.lastId;this.processing[o]={id:o,resolver:r,options:n};var s={message:{id:o,method:e,params:t},transfer:n&&n.transfer};this.terminated?r.reject(new Error("Worker is terminated")):this.worker.ready?this.worker.send(s.message,s.transfer):this.requestQueue.push(s);var a=this;return r.promise.catch(function(i){if(i instanceof q.CancellationError||i instanceof q.TimeoutError)return a.tracking[o]={id:o,resolver:q.defer(),options:n,error:i},delete a.processing[o],a.tracking[o].resolver.promise=a.tracking[o].resolver.promise.catch(function(u){if(delete a.tracking[o],u instanceof Se)throw u.error;var f=a.terminateAndNotify(!0).then(function(){throw u},function(l){throw l});return f}),a.worker.send({id:o,method:Pe}),a.tracking[o].timeoutId=setTimeout(function(){a.tracking[o].resolver.reject(i)},a.workerTerminateTimeout),a.tracking[o].resolver.promise;throw i})};N.prototype.busy=function(){return this.cleaning||Object.keys(this.processing).length>0};N.prototype.terminate=function(e,t){var r=this;if(e){for(var n in this.processing)this.processing[n]!==void 0&&this.processing[n].resolver.reject(new Error("Worker terminated"));this.processing=Object.create(null)}for(var o of Object.values(r.tracking))clearTimeout(o.timeoutId),o.resolver.reject(new Error("Worker Terminating"));if(r.tracking=Object.create(null),typeof t=="function"&&(this.terminationHandler=t),this.busy())this.terminating=!0;else{var s=function(i){if(r.terminated=!0,r.cleaning=!1,r.worker!=null&&r.worker.removeAllListeners&&r.worker.removeAllListeners("message"),r.worker=null,r.terminating=!1,r.terminationHandler)r.terminationHandler(i,r);else if(i)throw i};if(this.worker)if(typeof this.worker.kill=="function"){if(this.worker.killed){s(new Error("worker already killed!"));return}var a=setTimeout(function(){r.worker&&r.worker.kill()},this.workerTerminateTimeout);this.worker.once("exit",function(){clearTimeout(a),r.worker&&(r.worker.killed=!0),s()}),this.worker.ready?this.worker.send(Oe):this.requestQueue.push({message:Oe}),this.cleaning=!0;return}else if(typeof this.worker.terminate=="function")this.worker.terminate(),this.worker.killed=!0;else throw new Error("Failed to terminate worker");s()}};N.prototype.terminateAndNotify=function(e,t){var r=q.defer();return t&&r.promise.timeout(t),this.terminate(e,function(n,o){n?r.reject(n):r.resolve(o)}),r.promise};function Se(e){this.error=e,this.stack=new Error().stack}C.exports=N;C.exports._tryRequireWorkerThreads=re;C.exports._setupProcessWorker=ee;C.exports._setupBrowserWorker=Z;C.exports._setupWorkerThreadWorker=$;C.exports.ensureWorkerThreads=_e});var Me=W((qt,Ce)=>{"use strict";var Ae=65535;Ce.exports=ne;function ne(){this.ports=Object.create(null),this.length=0}ne.prototype.nextAvailableStartingAt=function(e){for(;this.ports[e]===!0;)e++;if(e>=Ae)throw new Error("WorkerPool debug port limit reached: "+e+">= "+Ae);return this.ports[e]=!0,this.length++,e};ne.prototype.releasePort=function(e){delete this.ports[e],this.length--}});var Ue=W((Ft,He)=>{var{Promise:oe}=H(),Ne=je(),mt=X(),ht=Me(),ie=new ht;function P(e,t){typeof e=="string"?this.script=e||null:(this.script=null,t=e),this.workers=[],this.tasks=[],t=t||{},this.forkArgs=Object.freeze(t.forkArgs||[]),this.forkOpts=Object.freeze(t.forkOpts||{}),this.workerOpts=Object.freeze(t.workerOpts||{}),this.workerThreadOpts=Object.freeze(t.workerThreadOpts||{}),this.debugPortStart=t.debugPortStart||43210,this.nodeWorker=t.nodeWorker,this.workerType=t.workerType||t.nodeWorker||"auto",this.maxQueueSize=t.maxQueueSize||1/0,this.workerTerminateTimeout=t.workerTerminateTimeout||1e3,this.onCreateWorker=t.onCreateWorker||(()=>null),this.onTerminateWorker=t.onTerminateWorker||(()=>null),this.emitStdStreams=t.emitStdStreams||!1,t&&"maxWorkers"in t?(pt(t.maxWorkers),this.maxWorkers=t.maxWorkers):this.maxWorkers=Math.max((mt.cpus||4)-1,1),t&&"minWorkers"in t&&(t.minWorkers==="max"?this.minWorkers=this.maxWorkers:(wt(t.minWorkers),this.minWorkers=t.minWorkers,this.maxWorkers=Math.max(this.minWorkers,this.maxWorkers)),this._ensureMinWorkers()),this._boundNext=this._next.bind(this),this.workerType==="thread"&&Ne.ensureWorkerThreads()}P.prototype.exec=function(e,t,r){if(t&&!Array.isArray(t))throw new TypeError('Array expected as argument "params"');if(typeof e=="string"){var n=oe.defer();if(this.tasks.length>=this.maxQueueSize)throw new Error("Max queue size of "+this.maxQueueSize+" reached");var o=this.tasks,s={method:e,params:t,resolver:n,timeout:null,options:r};o.push(s);var a=n.promise.timeout;return n.promise.timeout=function(u){return o.indexOf(s)!==-1?(s.timeout=u,n.promise):a.call(n.promise,u)},this._next(),n.promise}else{if(typeof e=="function")return this.exec("run",[String(e),t],r);throw new TypeError('Function or string expected as argument "method"')}};P.prototype.proxy=function(){if(arguments.length>0)throw new Error("No arguments expected");var e=this;return this.exec("methods").then(function(t){var r={};return t.forEach(function(n){r[n]=function(){return e.exec(n,Array.prototype.slice.call(arguments))}}),r})};P.prototype._next=function(){if(this.tasks.length>0){var e=this._getWorker();if(e){var t=this,r=this.tasks.shift();if(r.resolver.promise.pending){var n=e.exec(r.method,r.params,r.resolver,r.options).then(t._boundNext).catch(function(){if(e.terminated)return t._removeWorker(e)}).then(function(){t._next()});typeof r.timeout=="number"&&n.timeout(r.timeout)}else t._next()}}};P.prototype._getWorker=function(){for(var e=this.workers,t=0;t<e.length;t++){var r=e[t];if(r.busy()===!1)return r}return e.length<this.maxWorkers?(r=this._createWorkerHandler(),e.push(r),r):null};P.prototype._removeWorker=function(e){var t=this;return ie.releasePort(e.debugPort),this._removeWorkerFromList(e),this._ensureMinWorkers(),new oe(function(r,n){e.terminate(!1,function(o){t.onTerminateWorker({forkArgs:e.forkArgs,forkOpts:e.forkOpts,workerThreadOpts:e.workerThreadOpts,script:e.script}),o?n(o):r(e)})})};P.prototype._removeWorkerFromList=function(e){var t=this.workers.indexOf(e);t!==-1&&this.workers.splice(t,1)};P.prototype.terminate=function(e,t){var r=this;this.tasks.forEach(function(i){i.resolver.reject(new Error("Pool terminated"))}),this.tasks.length=0;var n=function(i){ie.releasePort(i.debugPort),this._removeWorkerFromList(i)},o=n.bind(this),s=[],a=this.workers.slice();return a.forEach(function(i){var u=i.terminateAndNotify(e,t).then(o).always(function(){r.onTerminateWorker({forkArgs:i.forkArgs,forkOpts:i.forkOpts,workerThreadOpts:i.workerThreadOpts,script:i.script})});s.push(u)}),oe.all(s)};P.prototype.stats=function(){var e=this.workers.length,t=this.workers.filter(function(r){return r.busy()}).length;return{totalWorkers:e,busyWorkers:t,idleWorkers:e-t,pendingTasks:this.tasks.length,activeTasks:t}};P.prototype._ensureMinWorkers=function(){if(this.minWorkers)for(var e=this.workers.length;e<this.minWorkers;e++)this.workers.push(this._createWorkerHandler())};P.prototype._createWorkerHandler=function(){let e=this.onCreateWorker({forkArgs:this.forkArgs,forkOpts:this.forkOpts,workerOpts:this.workerOpts,workerThreadOpts:this.workerThreadOpts,script:this.script})||{};return new Ne(e.script||this.script,{forkArgs:e.forkArgs||this.forkArgs,forkOpts:e.forkOpts||this.forkOpts,workerOpts:e.workerOpts||this.workerOpts,workerThreadOpts:e.workerThreadOpts||this.workerThreadOpts,debugPort:ie.nextAvailableStartingAt(this.debugPortStart),workerType:this.workerType,workerTerminateTimeout:this.workerTerminateTimeout,emitStdStreams:this.emitStdStreams})};function pt(e){if(!Re(e)||!De(e)||e<1)throw new TypeError("Option maxWorkers must be an integer number >= 1")}function wt(e){if(!Re(e)||!De(e)||e<0)throw new TypeError("Option minWorkers must be an integer number >= 0")}function Re(e){return typeof e=="number"}function De(e){return Math.round(e)==e}He.exports=P});var se=W((It,qe)=>{function gt(e,t){this.message=e,this.transfer=t}qe.exports=gt});var ae=W(Y=>{var ue=se(),z=H().Promise,kt="__workerpool-terminate__",Q="__workerpool-cleanup__",Fe=1e3,d={exit:function(){}},Ie={addAbortListener:function(e){d.abortListeners.push(e)},emit:d.emit};if(typeof self<"u"&&typeof postMessage=="function"&&typeof addEventListener=="function")d.on=function(e,t){addEventListener(e,function(r){t(r.data)})},d.send=function(e,t){t?postMessage(e,t):postMessage(e)};else if(typeof process<"u"){try{F=require("worker_threads")}catch(e){if(!(typeof e=="object"&&e!==null&&e.code==="MODULE_NOT_FOUND"))throw e}F&&F.parentPort!==null?(I=F.parentPort,d.send=I.postMessage.bind(I),d.on=I.on.bind(I),d.exit=process.exit.bind(process)):(d.on=process.on.bind(process),d.send=function(e){process.send(e)},d.on("disconnect",function(){process.exit(1)}),d.exit=process.exit.bind(process))}else throw new Error("Script must be executed as a worker");var F,I;function V(e){return e&&e.toJSON?JSON.parse(JSON.stringify(e)):JSON.parse(JSON.stringify(e,Object.getOwnPropertyNames(e)))}function ze(e){return e&&typeof e.then=="function"&&typeof e.catch=="function"}d.methods={};d.methods.run=function(t,r){var n=new Function("return ("+t+").apply(this, arguments);");return n.worker=Ie,n.apply(n,r)};d.methods.methods=function(){return Object.keys(d.methods)};d.terminationHandler=void 0;d.abortListenerTimeout=Fe;d.abortListeners=[];d.terminateAndExit=function(e){var t=function(){d.exit(e)};if(!d.terminationHandler)return t();var r=d.terminationHandler(e);return ze(r)?(r.then(t,t),r):(t(),new z(function(n,o){o(new Error("Worker terminating"))}))};d.cleanup=function(e){if(!d.abortListeners.length)return d.send({id:e,method:Q,error:V(new Error("Worker terminating"))}),new z(function(i){i()});var t=function(){d.exit()},r=function(){d.abortListeners.length||(d.abortListeners=[])};let n=d.abortListeners.map(i=>i()),o,s=new z((i,u)=>{o=setTimeout(function(){u(new Error("Timeout occured waiting for abort handler, killing worker"))},d.abortListenerTimeout)}),a=z.all(n).then(function(){clearTimeout(o),r()},function(){clearTimeout(o),t()});return new z(function(i,u){a.then(i,u),s.then(i,u)}).then(function(){d.send({id:e,method:Q,error:null})},function(i){d.send({id:e,method:Q,error:i?V(i):null})})};var M=null;d.on("message",function(e){if(e===kt)return d.terminateAndExit(0);if(e.method===Q)return d.cleanup(e.id);try{var t=d.methods[e.method];if(t){M=e.id;var r=t.apply(t,e.params);ze(r)?r.then(function(n){n instanceof ue?d.send({id:e.id,result:n.message,error:null},n.transfer):d.send({id:e.id,result:n,error:null}),M=null}).catch(function(n){d.send({id:e.id,result:null,error:V(n)}),M=null}):(r instanceof ue?d.send({id:e.id,result:r.message,error:null},r.transfer):d.send({id:e.id,result:r,error:null}),M=null)}else throw new Error('Unknown method "'+e.method+'"')}catch(n){d.send({id:e.id,result:null,error:V(n)})}});d.register=function(e,t){if(e)for(var r in e)e.hasOwnProperty(r)&&(d.methods[r]=e[r],d.methods[r].worker=Ie);t&&(d.terminationHandler=t.onTerminate,d.abortListenerTimeout=t.abortListenerTimeout||Fe),d.send("ready")};d.emit=function(e){if(M){if(e instanceof ue){d.send({id:M,isEvent:!0,payload:e.message},e.transfer);return}d.send({id:M,isEvent:!0,payload:e})}};typeof Y<"u"&&(Y.add=d.register,Y.emit=d.emit)});var Be=W(j=>{var{platform:vt,isMainThread:yt,cpus:bt}=X();function Ot(e,t){var r=Ue();return new r(e,t)}j.pool=Ot;function Tt(e,t){var r=ae();r.add(e,t)}j.worker=Tt;function xt(e){var t=ae();t.emit(e)}j.workerEmit=xt;var{Promise:Et}=H();j.Promise=Et;j.Transfer=se();j.platform=vt;j.isMainThread=yt;j.cpus=bt});var Xe=W((Jt,Je)=>{Je.exports=function(e,t){var r=e,n=t,o=r.length,s=n.length,a=!1,i=o+1,u=[],f=[],l,m,O=function(){o>=s&&(l=r,m=o,r=n,n=l,o=s,s=m,a=!0,i=o+1)},h=function(w,b,y,c,p){return{startX:w,startY:b,endX:y,endY:c,r:p}},v=function(w,b,y){var c,p,g,k,T;for(b>y?c=u[w-1+i]:c=u[w+1+i],T=g=Math.max(b,y),k=p=g-w;p<o&&g<s&&r[p]===n[g];)++p,++g;return k==p&&T==g?u[w+i]=c:(u[w+i]=f.length,f[f.length]=new h(k,T,p,g,c)),g};return O(),{compose:function(){var w,b,y,c,p,g,k,T,x,_;for(w=s-o,b=o+s+3,y={},g=0;g<b;++g)y[g]=-1,u[g]=-1;c=-1;do{for(++c,k=-c;k<=w-1;++k)y[k+i]=v(k,y[k-1+i]+1,y[k+1+i]);for(k=w+c;k>=w+1;--k)y[k+i]=v(k,y[k-1+i]+1,y[k+1+i]);y[w+i]=v(w,y[w-1+i]+1,y[w+1+i])}while(y[w+i]!==s);for(p=u[w+i],T=o,x=s,_=[];p!==-1;){let E=f[p];(o!=E.endX||s!=E.endY)&&_.push({file1:[a?E.endY:E.endX,a?x-E.endY:T-E.endX],file2:[a?E.endX:E.endY,a?T-E.endX:x-E.endY]}),T=E.startX,x=E.startY,p=f[p].r}return(T!=0||x!=0)&&_.push({file1:[0,a?x:T],file2:[0,a?T:x]}),_.reverse(),_}}}});var Ve=W((Xt,Ye)=>{var Qe=Xe();function Lt(e,t,r){var n,o=new Qe(t,e).compose(),s=new Qe(t,r).compose(),a=[];function i(S,K){a.push([S.file1[0],K,S.file1[1],S.file2[0],S.file2[1]])}for(n=0;n<o.length;n++)i(o[n],0);for(n=0;n<s.length;n++)i(s[n],2);a.sort(function(S,K){return S[0]-K[0]});var u=[],f=0;function l(S){S>f&&(u.push([1,f,S-f]),f=S)}for(var m=0;m<a.length;m++){for(var O=m,h=a[m],v=h[0],w=v+h[2];m<a.length-1;){var b=a[m+1],y=b[0];if(y>w)break;w=Math.max(w,y+b[2]),m++}if(l(v),O==m)h[4]>0&&u.push([h[1],h[3],h[4]]);else{var c={0:[e.length,-1,t.length,-1],2:[r.length,-1,t.length,-1]};for(n=O;n<=m;n++){h=a[n];var p=h[1],g=c[p],k=h[0],T=k+h[2],x=h[3],_=x+h[4];g[0]=Math.min(x,g[0]),g[1]=Math.max(_,g[1]),g[2]=Math.min(k,g[2]),g[3]=Math.max(T,g[3])}var E=c[0][0]+(v-c[0][2]),et=c[0][1]+(w-c[0][3]),de=c[2][0]+(v-c[2][2]),tt=c[2][1]+(w-c[2][3]);u.push([-1,E,et-E,v,w-v,de,tt-de])}f=w}return l(t.length),u}function Wt(e,t,r){var n=[],o=[e,t,r],s=Lt(e,t,r),a=[];function i(){a.length&&n.push({ok:a}),a=[]}function u(h){for(var v=0;v<h.length;v++)a.push(h[v])}function f(h){if(h[2]!=h[6])return!0;for(var v=h[1],w=h[5],b=0;b<h[2];b++)if(e[b+v]!=r[b+w])return!0;return!1}for(var l=0;l<s.length;l++){var m=s[l],O=m[0];O==-1?f(m)?(i(),n.push({conflict:{a:e.slice(m[1],m[1]+m[2]),aIndex:m[1],o:t.slice(m[3],m[3]+m[4]),oIndex:m[3],b:r.slice(m[5],m[5]+m[6]),bIndex:m[5]}})):u(o[0].slice(m[1],m[1]+m[2])):u(o[O].slice(m[1],m[1]+m[2]))}return i(),n}Ye.exports=Wt});var $e=he(Be());var Ke=he(Ve(),1);var G=class extends Error{constructor(){super("No Hunks found"),this.name="NoHunksFoundError"}};var B=class{diff(t,r,n={}){let o;typeof n=="function"?(o=n,n={}):"callback"in n&&(o=n.callback);let s=this.castInput(t,n),a=this.castInput(r,n),i=this.removeEmpty(this.tokenize(s,n)),u=this.removeEmpty(this.tokenize(a,n));return this.diffWithOptionsObj(i,u,n,o)}diffWithOptionsObj(t,r,n,o){var s;let a=c=>{if(c=this.postProcess(c,n),o){setTimeout(function(){o(c)},0);return}else return c},i=r.length,u=t.length,f=1,l=i+u;n.maxEditLength!=null&&(l=Math.min(l,n.maxEditLength));let m=(s=n.timeout)!==null&&s!==void 0?s:1/0,O=Date.now()+m,h=[{oldPos:-1,lastComponent:void 0}],v=this.extractCommon(h[0],r,t,0,n);if(h[0].oldPos+1>=u&&v+1>=i)return a(this.buildValues(h[0].lastComponent,r,t));let w=-1/0,b=1/0,y=()=>{for(let c=Math.max(w,-f);c<=Math.min(b,f);c+=2){let p,g=h[c-1],k=h[c+1];g&&(h[c-1]=void 0);let T=!1;if(k){let _=k.oldPos-c;T=k&&0<=_&&_<i}let x=g&&g.oldPos+1<u;if(!T&&!x){h[c]=void 0;continue}if(!x||T&&g.oldPos<k.oldPos?p=this.addToPath(k,!0,!1,0,n):p=this.addToPath(g,!1,!0,1,n),v=this.extractCommon(p,r,t,c,n),p.oldPos+1>=u&&v+1>=i)return a(this.buildValues(p.lastComponent,r,t))||!0;h[c]=p,p.oldPos+1>=u&&(b=Math.min(b,c-1)),v+1>=i&&(w=Math.max(w,c+1))}f++};if(o)(function c(){setTimeout(function(){if(f>l||Date.now()>O)return o(void 0);y()||c()},0)})();else for(;f<=l&&Date.now()<=O;){let c=y();if(c)return c}}addToPath(t,r,n,o,s){let a=t.lastComponent;return a&&!s.oneChangePerToken&&a.added===r&&a.removed===n?{oldPos:t.oldPos+o,lastComponent:{count:a.count+1,added:r,removed:n,previousComponent:a.previousComponent}}:{oldPos:t.oldPos+o,lastComponent:{count:1,added:r,removed:n,previousComponent:a}}}extractCommon(t,r,n,o,s){let a=r.length,i=n.length,u=t.oldPos,f=u-o,l=0;for(;f+1<a&&u+1<i&&this.equals(n[u+1],r[f+1],s);)f++,u++,l++,s.oneChangePerToken&&(t.lastComponent={count:1,previousComponent:t.lastComponent,added:!1,removed:!1});return l&&!s.oneChangePerToken&&(t.lastComponent={count:l,previousComponent:t.lastComponent,added:!1,removed:!1}),t.oldPos=u,f}equals(t,r,n){return n.comparator?n.comparator(t,r):t===r||!!n.ignoreCase&&t.toLowerCase()===r.toLowerCase()}removeEmpty(t){let r=[];for(let n=0;n<t.length;n++)t[n]&&r.push(t[n]);return r}castInput(t,r){return t}tokenize(t,r){return Array.from(t)}join(t){return t.join("")}postProcess(t,r){return t}get useLongestToken(){return!1}buildValues(t,r,n){let o=[],s;for(;t;)o.push(t),s=t.previousComponent,delete t.previousComponent,t=s;o.reverse();let a=o.length,i=0,u=0,f=0;for(;i<a;i++){let l=o[i];if(l.removed)l.value=this.join(n.slice(f,f+l.count)),f+=l.count;else{if(!l.added&&this.useLongestToken){let m=r.slice(u,u+l.count);m=m.map(function(O,h){let v=n[f+h];return v.length>O.length?v:O}),l.value=this.join(m)}else l.value=this.join(r.slice(u,u+l.count));u+=l.count,l.added||(f+=l.count)}}return o}};var fe=class extends B{constructor(){super(...arguments),this.tokenize=_t}equals(t,r,n){return n.ignoreWhitespace?((!n.newlineIsToken||!t.includes(`
`))&&(t=t.trim()),(!n.newlineIsToken||!r.includes(`
`))&&(r=r.trim())):n.ignoreNewlineAtEof&&!n.newlineIsToken&&(t.endsWith(`
`)&&(t=t.slice(0,-1)),r.endsWith(`
`)&&(r=r.slice(0,-1))),super.equals(t,r,n)}},Pt=new fe;function ce(e,t,r){return Pt.diff(e,t,r)}function _t(e,t){t.stripTrailingCr&&(e=e.replace(/\r\n/g,`
`));let r=[],n=e.split(/(\n|\r\n)/);n[n.length-1]||n.pop();for(let o=0;o<n.length;o++){let s=n[o];o%2&&!t.newlineIsToken?r[r.length-1]+=s:r.push(s)}return r}function le(e,t,r,n,o,s,a){let i;a?typeof a=="function"?i={callback:a}:i=a:i={},typeof i.context>"u"&&(i.context=4);let u=i.context;if(i.newlineIsToken)throw new Error("newlineIsToken may not be used with patch-generation functions, only with diffing functions");if(i.callback){let{callback:l}=i;ce(r,n,Object.assign(Object.assign({},i),{callback:m=>{let O=f(m);l(O)}}))}else return f(ce(r,n,i));function f(l){if(!l)return;l.push({value:"",lines:[]});function m(c){return c.map(function(p){return" "+p})}let O=[],h=0,v=0,w=[],b=1,y=1;for(let c=0;c<l.length;c++){let p=l[c],g=p.lines||St(p.value);if(p.lines=g,p.added||p.removed){if(!h){let k=l[c-1];h=b,v=y,k&&(w=u>0?m(k.lines.slice(-u)):[],h-=w.length,v-=w.length)}for(let k of g)w.push((p.added?"+":"-")+k);p.added?y+=g.length:b+=g.length}else{if(h)if(g.length<=u*2&&c<l.length-2)for(let k of m(g))w.push(k);else{let k=Math.min(g.length,u);for(let x of m(g.slice(0,k)))w.push(x);let T={oldStart:h,oldLines:b-h+k,newStart:v,newLines:y-v+k,lines:w};O.push(T),h=0,v=0,w=[]}b+=g.length,y+=g.length}}for(let c of O)for(let p=0;p<c.lines.length;p++)c.lines[p].endsWith(`
`)?c.lines[p]=c.lines[p].slice(0,-1):(c.lines.splice(p+1,0,"\\ No newline at end of file"),p++);return{oldFileName:e,newFileName:t,oldHeader:o,newHeader:s,hunks:O}}}function St(e){let t=e.endsWith(`
`),r=e.split(`
`).map(n=>n+`
`);return t?r.pop():r.push(r.pop().slice(0,-1)),r}var J=class e{startLine;count;constructor(t,r){this.startLine=t,this.count=r}get endLine(){return this.startLine+this.count-1}get startLineOneBased(){return this.startLine+1}get endLineOneBased(){return this.endLine+1}get rangeOutput(){return{startLine:this.startLineOneBased,count:this.count}}equals(t){return this.startLine===t.startLine&&this.count===t.count}doesIntersect(t){return this.startLine<=t.endLine&&t.startLine<=this.endLine}union(t){return e.fromEndLine(Math.min(this.startLine,t.startLine),Math.max(this.endLine,t.endLine))}static fromCount(t,r){return new e(t,r)}static fromEndLine(t,r){return new e(t,r-t+1)}static fromRangeOutput(t){return new e(t.startLine-1,t.count)}static fromOneBased(t,r){return e.fromEndLine(t-1,r-1)}static fromOneBasedCount(t,r){return e.fromCount(t-1,r)}};function Ge(e,t,r){return le("","",e,t,"","",{context:r}).hunks.map(o=>({oldRange:J.fromCount(o.oldStart-1,o.oldLines),newRange:J.fromCount(o.newStart-1,o.newLines)}))}function Ze(e,t,r){let n={lineNumber:-1,hasUserChanges:!1,hasMergeConflict:!1,beforeApply:"",afterApply:""};r!==e&&(n.hasUserChanges=!0);let o=(0,Ke.default)(r.split(`
`),e.split(`
`),t.split(`
`));o.some(f=>"conflict"in f)&&(n.hasMergeConflict=!0),n.beforeApply=r;let a=jt(o),i=At(r,a);n.afterApply=a;let u=Ct(i);return n.lineNumber=u,n}function jt(e){return e.map(t=>{if("ok"in t)return t.ok.join(`
`);if("conflict"in t)return t.conflict.b.join(`
`);throw"Unexpected: diff3 chunk type"}).join(`
`)}function At(e,t){return Ge(e,t,0).map(n=>n.oldRange)}function Ct(e){if(e.length===0)throw new G;if(e.length===1)return e[0].startLine;let r=e.reduce((o,s)=>o+s.count,0)/2,n=0;for(let o=0;o<e.length;o++){let s=e[o],a=n+s.count;if(a>=r)return s.startLine;n=a}throw"Unexpected: middle hunk not found"}$e.worker({doThreeWayMerge:Ze});
