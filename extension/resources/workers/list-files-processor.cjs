"use strict";var Ae=Object.create;var V=Object.defineProperty;var Se=Object.getOwnPropertyDescriptor;var je=Object.getOwnPropertyNames;var Le=Object.getPrototypeOf,Me=Object.prototype.hasOwnProperty;var g=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports);var Ne=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of je(r))!Me.call(e,i)&&i!==t&&V(e,i,{get:()=>r[i],enumerable:!(n=Se(r,i))||n.enumerable});return e};var X=(e,r,t)=>(t=e!=null?Ae(Le(e)):{},Ne(r||!e||!e.__esModule?V(t,"default",{value:e,enumerable:!0}):t,e));var L=g((rr,y)=>{var Y=function(e){return typeof e<"u"&&e.versions!=null&&e.versions.node!=null&&e+""=="[object process]"};y.exports.isNode=Y;y.exports.platform=typeof process<"u"&&Y(process)?"node":"browser";var $=y.exports.platform==="node"&&require("worker_threads");y.exports.isMainThread=y.exports.platform==="node"?(!$||$.isMainThread)&&!process.connected:typeof Window<"u";y.exports.cpus=y.exports.platform==="browser"?self.navigator.hardwareConcurrency:require("os").cpus().length});var _=g(ee=>{"use strict";function m(e,r){var t=this;if(!(this instanceof m))throw new SyntaxError("Constructor must be called with the new operator");if(typeof e!="function")throw new SyntaxError("Function parameter handler(resolve, reject) missing");var n=[],i=[];this.resolved=!1,this.rejected=!1,this.pending=!0,this[Symbol.toStringTag]="Promise";var u=function(a,f){n.push(a),i.push(f)};this.then=function(a,f){return new m(function(l,d){var h=a?Z(a,l,d):l,p=f?Z(f,l,d):d;u(h,p)},t)};var c=function(a){return t.resolved=!0,t.rejected=!1,t.pending=!1,n.forEach(function(f){f(a)}),u=function(f,l){f(a)},c=o=function(){},t},o=function(a){return t.resolved=!1,t.rejected=!0,t.pending=!1,i.forEach(function(f){f(a)}),u=function(f,l){l(a)},c=o=function(){},t};this.cancel=function(){return r?r.cancel():o(new E),t},this.timeout=function(a){if(r)r.timeout(a);else{var f=setTimeout(function(){o(new x("Promise timed out after "+a+" ms"))},a);t.always(function(){clearTimeout(f)})}return t},e(function(a){c(a)},function(a){o(a)})}function Z(e,r,t){return function(n){try{var i=e(n);i&&typeof i.then=="function"&&typeof i.catch=="function"?i.then(r,t):r(i)}catch(u){t(u)}}}m.prototype.catch=function(e){return this.then(null,e)};m.prototype.always=function(e){return this.then(e,e)};m.prototype.finally=function(e){let r=this,t=function(){return new m(n=>n()).then(e).then(()=>r)};return this.then(t,t)};m.all=function(e){return new m(function(r,t){var n=e.length,i=[];n?e.forEach(function(u,c){u.then(function(o){i[c]=o,n--,n==0&&r(i)},function(o){n=0,t(o)})}):r(i)})};m.defer=function(){var e={};return e.promise=new m(function(r,t){e.resolve=r,e.reject=t}),e};function E(e){this.message=e||"promise cancelled",this.stack=new Error().stack}E.prototype=new Error;E.prototype.constructor=Error;E.prototype.name="CancellationError";m.CancellationError=E;function x(e){this.message=e||"timeout exceeded",this.stack=new Error().stack}x.prototype=new Error;x.prototype.constructor=Error;x.prototype.name="TimeoutError";m.TimeoutError=x;ee.Promise=m});var re=g(W=>{W.validateOptions=function(r,t,n){if(r){var i=r?Object.keys(r):[],u=i.find(o=>!t.includes(o));if(u)throw new Error('Object "'+n+'" contains an unknown option "'+u+'"');var c=t.find(o=>Object.prototype[o]&&!i.includes(o));if(c)throw new Error('Object "'+n+'" contains an inherited option "'+c+'" which is not defined in the object itself but in its prototype. Only plain objects are allowed. Please remove the option from the prototype or override it with a value "undefined".');return r}};W.workerOptsNames=["credentials","name","type"];W.forkOptsNames=["cwd","detached","env","execPath","execArgv","gid","serialization","signal","killSignal","silent","stdio","uid","windowsVerbatimArguments","timeout"];W.workerThreadOptsNames=["argv","env","eval","execArgv","stdin","stdout","stderr","workerData","trackUnmanagedFds","transferList","resourceLimits","name"]});var ne=g((or,te)=>{te.exports=`!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).worker=n()}(this,(function(){"use strict";function e(n){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(n)}function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var t={};var r=function(e,n){this.message=e,this.transfer=n},o={};function i(e,n){var t=this;if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if("function"!=typeof e)throw new SyntaxError("Function parameter handler(resolve, reject) missing");var r=[],o=[];this.resolved=!1,this.rejected=!1,this.pending=!0,this[Symbol.toStringTag]="Promise";var a=function(e,n){r.push(e),o.push(n)};this.then=function(e,n){return new i((function(t,r){var o=e?s(e,t,r):t,i=n?s(n,t,r):r;a(o,i)}),t)};var f=function(e){return t.resolved=!0,t.rejected=!1,t.pending=!1,r.forEach((function(n){n(e)})),a=function(n,t){n(e)},f=d=function(){},t},d=function(e){return t.resolved=!1,t.rejected=!0,t.pending=!1,o.forEach((function(n){n(e)})),a=function(n,t){t(e)},f=d=function(){},t};this.cancel=function(){return n?n.cancel():d(new u),t},this.timeout=function(e){if(n)n.timeout(e);else{var r=setTimeout((function(){d(new c("Promise timed out after "+e+" ms"))}),e);t.always((function(){clearTimeout(r)}))}return t},e((function(e){f(e)}),(function(e){d(e)}))}function s(e,n,t){return function(r){try{var o=e(r);o&&"function"==typeof o.then&&"function"==typeof o.catch?o.then(n,t):n(o)}catch(e){t(e)}}}function u(e){this.message=e||"promise cancelled",this.stack=(new Error).stack}function c(e){this.message=e||"timeout exceeded",this.stack=(new Error).stack}return i.prototype.catch=function(e){return this.then(null,e)},i.prototype.always=function(e){return this.then(e,e)},i.prototype.finally=function(e){var n=this,t=function(){return new i((function(e){return e()})).then(e).then((function(){return n}))};return this.then(t,t)},i.all=function(e){return new i((function(n,t){var r=e.length,o=[];r?e.forEach((function(e,i){e.then((function(e){o[i]=e,0==--r&&n(o)}),(function(e){r=0,t(e)}))})):n(o)}))},i.defer=function(){var e={};return e.promise=new i((function(n,t){e.resolve=n,e.reject=t})),e},u.prototype=new Error,u.prototype.constructor=Error,u.prototype.name="CancellationError",i.CancellationError=u,c.prototype=new Error,c.prototype.constructor=Error,c.prototype.name="TimeoutError",i.TimeoutError=c,o.Promise=i,function(n){var t=r,i=o.Promise,s="__workerpool-cleanup__",u={exit:function(){}},c={addAbortListener:function(e){u.abortListeners.push(e)},emit:u.emit};if("undefined"!=typeof self&&"function"==typeof postMessage&&"function"==typeof addEventListener)u.on=function(e,n){addEventListener(e,(function(e){n(e.data)}))},u.send=function(e,n){n?postMessage(e,n):postMessage(e)};else{if("undefined"==typeof process)throw new Error("Script must be executed as a worker");var a;try{a=require("worker_threads")}catch(n){if("object"!==e(n)||null===n||"MODULE_NOT_FOUND"!==n.code)throw n}if(a&&null!==a.parentPort){var f=a.parentPort;u.send=f.postMessage.bind(f),u.on=f.on.bind(f),u.exit=process.exit.bind(process)}else u.on=process.on.bind(process),u.send=function(e){process.send(e)},u.on("disconnect",(function(){process.exit(1)})),u.exit=process.exit.bind(process)}function d(e){return e&&e.toJSON?JSON.parse(JSON.stringify(e)):JSON.parse(JSON.stringify(e,Object.getOwnPropertyNames(e)))}function l(e){return e&&"function"==typeof e.then&&"function"==typeof e.catch}u.methods={},u.methods.run=function(e,n){var t=new Function("return ("+e+").apply(this, arguments);");return t.worker=c,t.apply(t,n)},u.methods.methods=function(){return Object.keys(u.methods)},u.terminationHandler=void 0,u.abortListenerTimeout=1e3,u.abortListeners=[],u.terminateAndExit=function(e){var n=function(){u.exit(e)};if(!u.terminationHandler)return n();var t=u.terminationHandler(e);return l(t)?(t.then(n,n),t):(n(),new i((function(e,n){n(new Error("Worker terminating"))})))},u.cleanup=function(e){if(!u.abortListeners.length)return u.send({id:e,method:s,error:d(new Error("Worker terminating"))}),new i((function(e){e()}));var n,t=u.abortListeners.map((function(e){return e()})),r=new i((function(e,t){n=setTimeout((function(){t(new Error("Timeout occured waiting for abort handler, killing worker"))}),u.abortListenerTimeout)})),o=i.all(t).then((function(){clearTimeout(n),u.abortListeners.length||(u.abortListeners=[])}),(function(){clearTimeout(n),u.exit()}));return new i((function(e,n){o.then(e,n),r.then(e,n)})).then((function(){u.send({id:e,method:s,error:null})}),(function(n){u.send({id:e,method:s,error:n?d(n):null})}))};var p=null;u.on("message",(function(e){if("__workerpool-terminate__"===e)return u.terminateAndExit(0);if(e.method===s)return u.cleanup(e.id);try{var n=u.methods[e.method];if(!n)throw new Error('Unknown method "'+e.method+'"');p=e.id;var r=n.apply(n,e.params);l(r)?r.then((function(n){n instanceof t?u.send({id:e.id,result:n.message,error:null},n.transfer):u.send({id:e.id,result:n,error:null}),p=null})).catch((function(n){u.send({id:e.id,result:null,error:d(n)}),p=null})):(r instanceof t?u.send({id:e.id,result:r.message,error:null},r.transfer):u.send({id:e.id,result:r,error:null}),p=null)}catch(n){u.send({id:e.id,result:null,error:d(n)})}})),u.register=function(e,n){if(e)for(var t in e)e.hasOwnProperty(t)&&(u.methods[t]=e[t],u.methods[t].worker=c);n&&(u.terminationHandler=n.onTerminate,u.abortListenerTimeout=n.abortListenerTimeout||1e3),u.send("ready")},u.emit=function(e){if(p){if(e instanceof t)return void u.send({id:p,isEvent:!0,payload:e.message},e.transfer);u.send({id:p,isEvent:!0,payload:e})}},n.add=u.register,n.emit=u.emit}(t),n(t)}));
//# sourceMappingURL=worker.min.js.map
`});var he=g((ir,b)=>{"use strict";var{Promise:P}=_(),ce=L(),{validateOptions:R,forkOptsNames:De,workerThreadOptsNames:Ue,workerOptsNames:qe}=re(),oe="__workerpool-terminate__",fe="__workerpool-cleanup__";function le(){var e=F();if(!e)throw new Error("WorkerPool: workerType = 'thread' is not supported, Node >= 11.7.0 required");return e}function ie(){if(typeof Worker!="function"&&(typeof Worker!="object"||typeof Worker.prototype.constructor!="function"))throw new Error("WorkerPool: Web Workers not supported")}function F(){try{return require("worker_threads")}catch(e){if(typeof e=="object"&&e!==null&&e.code==="MODULE_NOT_FOUND")return null;throw e}}function He(){if(ce.platform==="browser"){if(typeof Blob>"u")throw new Error("Blob not supported by the browser");if(!window.URL||typeof window.URL.createObjectURL!="function")throw new Error("URL.createObjectURL not supported by the browser");var e=new Blob([ne()],{type:"text/javascript"});return window.URL.createObjectURL(e)}else return __dirname+"/worker.js"}function Ce(e,r){if(r.workerType==="web")return ie(),q(e,r.workerOpts,Worker);if(r.workerType==="thread")return t=le(),H(e,t,r);if(r.workerType==="process"||!r.workerType)return C(e,se(r),require("child_process"));if(ce.platform==="browser")return ie(),q(e,r.workerOpts,Worker);var t=F();return t?H(e,t,r):C(e,se(r),require("child_process"))}function q(e,r,t){R(r,qe,"workerOpts");var n=new t(e,r);return n.isBrowserWorker=!0,n.on=function(i,u){this.addEventListener(i,function(c){u(c.data)})},n.send=function(i,u){this.postMessage(i,u)},n}function H(e,r,t){R(t?.workerThreadOpts,Ue,"workerThreadOpts");var n=new r.Worker(e,{stdout:t?.emitStdStreams??!1,stderr:t?.emitStdStreams??!1,...t?.workerThreadOpts});return n.isWorkerThread=!0,n.send=function(i,u){this.postMessage(i,u)},n.kill=function(){return this.terminate(),!0},n.disconnect=function(){this.terminate()},t?.emitStdStreams&&(n.stdout.on("data",i=>n.emit("stdout",i)),n.stderr.on("data",i=>n.emit("stderr",i))),n}function C(e,r,t){R(r.forkOpts,De,"forkOpts");var n=t.fork(e,r.forkArgs,r.forkOpts),i=n.send;return n.send=function(u){return i.call(n,u)},r.emitStdStreams&&(n.stdout.on("data",u=>n.emit("stdout",u)),n.stderr.on("data",u=>n.emit("stderr",u))),n.isChildProcess=!0,n}function se(e){e=e||{};var r=process.execArgv.join(" "),t=r.indexOf("--inspect")!==-1,n=r.indexOf("--debug-brk")!==-1,i=[];return t&&(i.push("--inspect="+e.debugPort),n&&i.push("--debug-brk")),process.execArgv.forEach(function(u){u.indexOf("--max-old-space-size")>-1&&i.push(u)}),Object.assign({},e,{forkArgs:e.forkArgs,forkOpts:Object.assign({},e.forkOpts,{execArgv:(e.forkOpts&&e.forkOpts.execArgv||[]).concat(i),stdio:e.emitStdStreams?"pipe":void 0})})}function ue(e){for(var r=new Error(""),t=Object.keys(e),n=0;n<t.length;n++)r[t[n]]=e[t[n]];return r}function ae(e,r){Object.values(e.processing).forEach(t=>t?.options?.on(r)),Object.values(e.tracking).forEach(t=>t?.options?.on(r))}function T(e,r){var t=this,n=r||{};this.script=e||He(),this.worker=Ce(this.script,n),this.debugPort=n.debugPort,this.forkOpts=n.forkOpts,this.forkArgs=n.forkArgs,this.workerOpts=n.workerOpts,this.workerThreadOpts=n.workerThreadOpts,this.workerTerminateTimeout=n.workerTerminateTimeout,e||(this.worker.ready=!0),this.requestQueue=[],this.worker.on("stdout",function(o){ae(t,{stdout:o.toString()})}),this.worker.on("stderr",function(o){ae(t,{stderr:o.toString()})}),this.worker.on("message",function(o){if(!t.terminated)if(typeof o=="string"&&o==="ready")t.worker.ready=!0,u();else{var a=o.id,f=t.processing[a];if(f!==void 0)o.isEvent?f.options&&typeof f.options.on=="function"&&f.options.on(o.payload):(delete t.processing[a],t.terminating===!0&&t.terminate(),o.error?f.resolver.reject(ue(o.error)):f.resolver.resolve(o.result));else{var f=t.tracking[a];f!==void 0&&o.isEvent&&f.options&&typeof f.options.on=="function"&&f.options.on(o.payload)}if(o.method===fe){var l=t.tracking[o.id];l!==void 0&&(o.error?(clearTimeout(l.timeoutId),l.resolver.reject(ue(o.error))):(t.tracking&&clearTimeout(l.timeoutId),l.resolver.reject(new de(l.error)))),delete t.tracking[a]}}});function i(o){t.terminated=!0;for(var a in t.processing)t.processing[a]!==void 0&&t.processing[a].resolver.reject(o);t.processing=Object.create(null)}function u(){for(let o of t.requestQueue.splice(0))t.worker.send(o.message,o.transfer)}var c=this.worker;this.worker.on("error",i),this.worker.on("exit",function(o,a){var f=`Workerpool Worker terminated Unexpectedly
`;f+="    exitCode: `"+o+"`\n",f+="    signalCode: `"+a+"`\n",f+="    workerpool.script: `"+t.script+"`\n",f+="    spawnArgs: `"+c.spawnargs+"`\n",f+="    spawnfile: `"+c.spawnfile+"`\n",f+="    stdout: `"+c.stdout+"`\n",f+="    stderr: `"+c.stderr+"`\n",i(new Error(f))}),this.processing=Object.create(null),this.tracking=Object.create(null),this.terminating=!1,this.terminated=!1,this.cleaning=!1,this.terminationHandler=null,this.lastId=0}T.prototype.methods=function(){return this.exec("methods")};T.prototype.exec=function(e,r,t,n){t||(t=P.defer());var i=++this.lastId;this.processing[i]={id:i,resolver:t,options:n};var u={message:{id:i,method:e,params:r},transfer:n&&n.transfer};this.terminated?t.reject(new Error("Worker is terminated")):this.worker.ready?this.worker.send(u.message,u.transfer):this.requestQueue.push(u);var c=this;return t.promise.catch(function(o){if(o instanceof P.CancellationError||o instanceof P.TimeoutError)return c.tracking[i]={id:i,resolver:P.defer(),options:n,error:o},delete c.processing[i],c.tracking[i].resolver.promise=c.tracking[i].resolver.promise.catch(function(a){if(delete c.tracking[i],a instanceof de)throw a.error;var f=c.terminateAndNotify(!0).then(function(){throw a},function(l){throw l});return f}),c.worker.send({id:i,method:fe}),c.tracking[i].timeoutId=setTimeout(function(){c.tracking[i].resolver.reject(o)},c.workerTerminateTimeout),c.tracking[i].resolver.promise;throw o})};T.prototype.busy=function(){return this.cleaning||Object.keys(this.processing).length>0};T.prototype.terminate=function(e,r){var t=this;if(e){for(var n in this.processing)this.processing[n]!==void 0&&this.processing[n].resolver.reject(new Error("Worker terminated"));this.processing=Object.create(null)}for(var i of Object.values(t.tracking))clearTimeout(i.timeoutId),i.resolver.reject(new Error("Worker Terminating"));if(t.tracking=Object.create(null),typeof r=="function"&&(this.terminationHandler=r),this.busy())this.terminating=!0;else{var u=function(o){if(t.terminated=!0,t.cleaning=!1,t.worker!=null&&t.worker.removeAllListeners&&t.worker.removeAllListeners("message"),t.worker=null,t.terminating=!1,t.terminationHandler)t.terminationHandler(o,t);else if(o)throw o};if(this.worker)if(typeof this.worker.kill=="function"){if(this.worker.killed){u(new Error("worker already killed!"));return}var c=setTimeout(function(){t.worker&&t.worker.kill()},this.workerTerminateTimeout);this.worker.once("exit",function(){clearTimeout(c),t.worker&&(t.worker.killed=!0),u()}),this.worker.ready?this.worker.send(oe):this.requestQueue.push({message:oe}),this.cleaning=!0;return}else if(typeof this.worker.terminate=="function")this.worker.terminate(),this.worker.killed=!0;else throw new Error("Failed to terminate worker");u()}};T.prototype.terminateAndNotify=function(e,r){var t=P.defer();return r&&t.promise.timeout(r),this.terminate(e,function(n,i){n?t.reject(n):t.resolve(i)}),t.promise};function de(e){this.error=e,this.stack=new Error().stack}b.exports=T;b.exports._tryRequireWorkerThreads=F;b.exports._setupProcessWorker=C;b.exports._setupBrowserWorker=q;b.exports._setupWorkerThreadWorker=H;b.exports.ensureWorkerThreads=le});var we=g((sr,me)=>{"use strict";var pe=65535;me.exports=I;function I(){this.ports=Object.create(null),this.length=0}I.prototype.nextAvailableStartingAt=function(e){for(;this.ports[e]===!0;)e++;if(e>=pe)throw new Error("WorkerPool debug port limit reached: "+e+">= "+pe);return this.ports[e]=!0,this.length++,e};I.prototype.releasePort=function(e){delete this.ports[e],this.length--}});var be=g((ur,ye)=>{var{Promise:z}=_(),ke=he(),Re=L(),Fe=we(),B=new Fe;function k(e,r){typeof e=="string"?this.script=e||null:(this.script=null,r=e),this.workers=[],this.tasks=[],r=r||{},this.forkArgs=Object.freeze(r.forkArgs||[]),this.forkOpts=Object.freeze(r.forkOpts||{}),this.workerOpts=Object.freeze(r.workerOpts||{}),this.workerThreadOpts=Object.freeze(r.workerThreadOpts||{}),this.debugPortStart=r.debugPortStart||43210,this.nodeWorker=r.nodeWorker,this.workerType=r.workerType||r.nodeWorker||"auto",this.maxQueueSize=r.maxQueueSize||1/0,this.workerTerminateTimeout=r.workerTerminateTimeout||1e3,this.onCreateWorker=r.onCreateWorker||(()=>null),this.onTerminateWorker=r.onTerminateWorker||(()=>null),this.emitStdStreams=r.emitStdStreams||!1,r&&"maxWorkers"in r?(Ie(r.maxWorkers),this.maxWorkers=r.maxWorkers):this.maxWorkers=Math.max((Re.cpus||4)-1,1),r&&"minWorkers"in r&&(r.minWorkers==="max"?this.minWorkers=this.maxWorkers:(ze(r.minWorkers),this.minWorkers=r.minWorkers,this.maxWorkers=Math.max(this.minWorkers,this.maxWorkers)),this._ensureMinWorkers()),this._boundNext=this._next.bind(this),this.workerType==="thread"&&ke.ensureWorkerThreads()}k.prototype.exec=function(e,r,t){if(r&&!Array.isArray(r))throw new TypeError('Array expected as argument "params"');if(typeof e=="string"){var n=z.defer();if(this.tasks.length>=this.maxQueueSize)throw new Error("Max queue size of "+this.maxQueueSize+" reached");var i=this.tasks,u={method:e,params:r,resolver:n,timeout:null,options:t};i.push(u);var c=n.promise.timeout;return n.promise.timeout=function(a){return i.indexOf(u)!==-1?(u.timeout=a,n.promise):c.call(n.promise,a)},this._next(),n.promise}else{if(typeof e=="function")return this.exec("run",[String(e),r],t);throw new TypeError('Function or string expected as argument "method"')}};k.prototype.proxy=function(){if(arguments.length>0)throw new Error("No arguments expected");var e=this;return this.exec("methods").then(function(r){var t={};return r.forEach(function(n){t[n]=function(){return e.exec(n,Array.prototype.slice.call(arguments))}}),t})};k.prototype._next=function(){if(this.tasks.length>0){var e=this._getWorker();if(e){var r=this,t=this.tasks.shift();if(t.resolver.promise.pending){var n=e.exec(t.method,t.params,t.resolver,t.options).then(r._boundNext).catch(function(){if(e.terminated)return r._removeWorker(e)}).then(function(){r._next()});typeof t.timeout=="number"&&n.timeout(t.timeout)}else r._next()}}};k.prototype._getWorker=function(){for(var e=this.workers,r=0;r<e.length;r++){var t=e[r];if(t.busy()===!1)return t}return e.length<this.maxWorkers?(t=this._createWorkerHandler(),e.push(t),t):null};k.prototype._removeWorker=function(e){var r=this;return B.releasePort(e.debugPort),this._removeWorkerFromList(e),this._ensureMinWorkers(),new z(function(t,n){e.terminate(!1,function(i){r.onTerminateWorker({forkArgs:e.forkArgs,forkOpts:e.forkOpts,workerThreadOpts:e.workerThreadOpts,script:e.script}),i?n(i):t(e)})})};k.prototype._removeWorkerFromList=function(e){var r=this.workers.indexOf(e);r!==-1&&this.workers.splice(r,1)};k.prototype.terminate=function(e,r){var t=this;this.tasks.forEach(function(o){o.resolver.reject(new Error("Pool terminated"))}),this.tasks.length=0;var n=function(o){B.releasePort(o.debugPort),this._removeWorkerFromList(o)},i=n.bind(this),u=[],c=this.workers.slice();return c.forEach(function(o){var a=o.terminateAndNotify(e,r).then(i).always(function(){t.onTerminateWorker({forkArgs:o.forkArgs,forkOpts:o.forkOpts,workerThreadOpts:o.workerThreadOpts,script:o.script})});u.push(a)}),z.all(u)};k.prototype.stats=function(){var e=this.workers.length,r=this.workers.filter(function(t){return t.busy()}).length;return{totalWorkers:e,busyWorkers:r,idleWorkers:e-r,pendingTasks:this.tasks.length,activeTasks:r}};k.prototype._ensureMinWorkers=function(){if(this.minWorkers)for(var e=this.workers.length;e<this.minWorkers;e++)this.workers.push(this._createWorkerHandler())};k.prototype._createWorkerHandler=function(){let e=this.onCreateWorker({forkArgs:this.forkArgs,forkOpts:this.forkOpts,workerOpts:this.workerOpts,workerThreadOpts:this.workerThreadOpts,script:this.script})||{};return new ke(e.script||this.script,{forkArgs:e.forkArgs||this.forkArgs,forkOpts:e.forkOpts||this.forkOpts,workerOpts:e.workerOpts||this.workerOpts,workerThreadOpts:e.workerThreadOpts||this.workerThreadOpts,debugPort:B.nextAvailableStartingAt(this.debugPortStart),workerType:this.workerType,workerTerminateTimeout:this.workerTerminateTimeout,emitStdStreams:this.emitStdStreams})};function Ie(e){if(!ge(e)||!ve(e)||e<1)throw new TypeError("Option maxWorkers must be an integer number >= 1")}function ze(e){if(!ge(e)||!ve(e)||e<0)throw new TypeError("Option minWorkers must be an integer number >= 0")}function ge(e){return typeof e=="number"}function ve(e){return Math.round(e)==e}ye.exports=k});var J=g((ar,Oe)=>{function Be(e,r){this.message=e,this.transfer=r}Oe.exports=Be});var G=g(N=>{var Q=J(),j=_().Promise,Je="__workerpool-terminate__",M="__workerpool-cleanup__",Te=1e3,s={exit:function(){}},Ee={addAbortListener:function(e){s.abortListeners.push(e)},emit:s.emit};if(typeof self<"u"&&typeof postMessage=="function"&&typeof addEventListener=="function")s.on=function(e,r){addEventListener(e,function(t){r(t.data)})},s.send=function(e,r){r?postMessage(e,r):postMessage(e)};else if(typeof process<"u"){try{A=require("worker_threads")}catch(e){if(!(typeof e=="object"&&e!==null&&e.code==="MODULE_NOT_FOUND"))throw e}A&&A.parentPort!==null?(S=A.parentPort,s.send=S.postMessage.bind(S),s.on=S.on.bind(S),s.exit=process.exit.bind(process)):(s.on=process.on.bind(process),s.send=function(e){process.send(e)},s.on("disconnect",function(){process.exit(1)}),s.exit=process.exit.bind(process))}else throw new Error("Script must be executed as a worker");var A,S;function D(e){return e&&e.toJSON?JSON.parse(JSON.stringify(e)):JSON.parse(JSON.stringify(e,Object.getOwnPropertyNames(e)))}function xe(e){return e&&typeof e.then=="function"&&typeof e.catch=="function"}s.methods={};s.methods.run=function(r,t){var n=new Function("return ("+r+").apply(this, arguments);");return n.worker=Ee,n.apply(n,t)};s.methods.methods=function(){return Object.keys(s.methods)};s.terminationHandler=void 0;s.abortListenerTimeout=Te;s.abortListeners=[];s.terminateAndExit=function(e){var r=function(){s.exit(e)};if(!s.terminationHandler)return r();var t=s.terminationHandler(e);return xe(t)?(t.then(r,r),t):(r(),new j(function(n,i){i(new Error("Worker terminating"))}))};s.cleanup=function(e){if(!s.abortListeners.length)return s.send({id:e,method:M,error:D(new Error("Worker terminating"))}),new j(function(o){o()});var r=function(){s.exit()},t=function(){s.abortListeners.length||(s.abortListeners=[])};let n=s.abortListeners.map(o=>o()),i,u=new j((o,a)=>{i=setTimeout(function(){a(new Error("Timeout occured waiting for abort handler, killing worker"))},s.abortListenerTimeout)}),c=j.all(n).then(function(){clearTimeout(i),t()},function(){clearTimeout(i),r()});return new j(function(o,a){c.then(o,a),u.then(o,a)}).then(function(){s.send({id:e,method:M,error:null})},function(o){s.send({id:e,method:M,error:o?D(o):null})})};var O=null;s.on("message",function(e){if(e===Je)return s.terminateAndExit(0);if(e.method===M)return s.cleanup(e.id);try{var r=s.methods[e.method];if(r){O=e.id;var t=r.apply(r,e.params);xe(t)?t.then(function(n){n instanceof Q?s.send({id:e.id,result:n.message,error:null},n.transfer):s.send({id:e.id,result:n,error:null}),O=null}).catch(function(n){s.send({id:e.id,result:null,error:D(n)}),O=null}):(t instanceof Q?s.send({id:e.id,result:t.message,error:null},t.transfer):s.send({id:e.id,result:t,error:null}),O=null)}else throw new Error('Unknown method "'+e.method+'"')}catch(n){s.send({id:e.id,result:null,error:D(n)})}});s.register=function(e,r){if(e)for(var t in e)e.hasOwnProperty(t)&&(s.methods[t]=e[t],s.methods[t].worker=Ee);r&&(s.terminationHandler=r.onTerminate,s.abortListenerTimeout=r.abortListenerTimeout||Te),s.send("ready")};s.emit=function(e){if(O){if(e instanceof Q){s.send({id:O,isEvent:!0,payload:e.message},e.transfer);return}s.send({id:O,isEvent:!0,payload:e})}};typeof N<"u"&&(N.add=s.register,N.emit=s.emit)});var _e=g(v=>{var{platform:Qe,isMainThread:Ge,cpus:Ke}=L();function Ve(e,r){var t=be();return new t(e,r)}v.pool=Ve;function Xe(e,r){var t=G();t.add(e,r)}v.worker=Xe;function $e(e){var r=G();r.emit(e)}v.workerEmit=$e;var{Promise:Ye}=_();v.Promise=Ye;v.Transfer=J();v.platform=Qe;v.isMainThread=Ge;v.cpus=Ke});var w=X(require("path")),Pe=X(_e());function U(e){return e===""?".":e}function We(e,r,t){return{absolutePath:w.default.join(r,e),isDirectory:t}}function Ze(e){let{filePaths:r,directoryPaths:t,rootAbsolutePath:n,rootPath:i,workspacePath:u}=e,c=U(w.default.relative(u,n)),o=new Map;o.set(c,{path:i,filePaths:[],subDirectories:[]});let a=new Set;for(let d of t){let h=U(w.default.relative(u,d));for(;h!=="."&&!o.has(h);)a.add(h),h=(0,w.dirname)(h)}for(let d of r){let h=U(w.default.relative(u,d)),p=(0,w.dirname)(h);for(;p!=="."&&!o.has(p);)a.add(p),p=(0,w.dirname)(p)}for(let d of a)o.set(d,{path:We(d,u,!0),filePaths:[],subDirectories:[]});for(let d of r){let h=U(w.default.relative(u,d)),p=(0,w.dirname)(h),K=o.get(p==="."?c:p);K&&K.filePaths.push(We(h,u,!1))}let f=[];for(let[d,h]of o){if(d===c)continue;let p=(0,w.dirname)(d);f.push([p,h])}for(let[d,h]of f){let p=o.get(d);p&&p.subDirectories.push(h)}let l=o.get(c);if(!l)throw new Error(`Root directory ${c} missing from directory map.`);return l}Pe.worker({buildDirectoryTree:Ze});
