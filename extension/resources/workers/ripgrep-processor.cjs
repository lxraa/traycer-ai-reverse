"use strict";var ot=Object.create;var he=Object.defineProperty;var st=Object.getOwnPropertyDescriptor;var at=Object.getOwnPropertyNames;var ut=Object.getPrototypeOf,ct=Object.prototype.hasOwnProperty;var m=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var ft=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of at(t))!ct.call(e,i)&&i!==r&&he(e,i,{get:()=>t[i],enumerable:!(n=st(t,i))||n.enumerable});return e};var $=(e,t,r)=>(r=e!=null?ot(ut(e)):{},ft(t||!e||!e.__esModule?he(r,"default",{value:e,enumerable:!0}):r,e));var ve=m((ir,U)=>{function ge(e){return Array.isArray(e)?e:[e]}var lt=void 0,J="",de=" ",X="\\",ht=/^\s+$/,pt=/(?:[^\\]|^)\\$/,dt=/^\\!/,mt=/^\\#/,gt=/\r?\n/g,wt=/^\.{0,2}\/|^\.{1,2}$/,kt=/\/$/,O="/",we="node-ignore";typeof Symbol<"u"&&(we=Symbol.for("node-ignore"));var ke=we,P=(e,t,r)=>(Object.defineProperty(e,t,{value:r}),r),bt=/([0-z])-([0-z])/g,be=()=>!1,_t=e=>e.replace(bt,(t,r,n)=>r.charCodeAt(0)<=n.charCodeAt(0)?t:J),yt=e=>{let{length:t}=e;return e.slice(0,t-t%2)},vt=[[/^\uFEFF/,()=>J],[/((?:\\\\)*?)(\\?\s+)$/,(e,t,r)=>t+(r.indexOf("\\")===0?de:J)],[/(\\+?)\s/g,(e,t)=>{let{length:r}=t;return t.slice(0,r-r%2)+de}],[/[\\$.|*+(){^]/g,e=>`\\${e}`],[/(?!\\)\?/g,()=>"[^/]"],[/^\//,()=>"^"],[/\//g,()=>"\\/"],[/^\^*\\\*\\\*\\\//,()=>"^(?:.*\\/)?"],[/^(?=[^^])/,function(){return/\/(?!$)/.test(this)?"^":"(?:^|\\/)"}],[/\\\/\\\*\\\*(?=\\\/|$)/g,(e,t,r)=>t+6<r.length?"(?:\\/[^\\/]+)*":"\\/.+"],[/(^|[^\\]+)(\\\*)+(?=.+)/g,(e,t,r)=>{let n=r.replace(/\\\*/g,"[^\\/]*");return t+n}],[/\\\\\\(?=[$.|*+(){^])/g,()=>X],[/\\\\/g,()=>X],[/(\\)?\[([^\]/]*?)(\\*)($|\])/g,(e,t,r,n,i)=>t===X?`\\[${r}${yt(n)}${i}`:i==="]"&&n.length%2===0?`[${_t(r)}${n}]`:"[]"],[/(?:[^*])$/,e=>/\/$/.test(e)?`${e}$`:`${e}(?=$|\\/$)`]],Et=/(^|\\\/)?\\\*$/,S="regex",F="checkRegex",me="_",xt={[S](e,t){return`${t?`${t}[^/]+`:"[^/]*"}(?=$|\\/$)`},[F](e,t){return`${t?`${t}[^/]*`:"[^/]*"}(?=$|\\/$)`}},Ot=e=>vt.reduce((t,[r,n])=>t.replace(r,n.bind(e)),e),q=e=>typeof e=="string",Pt=e=>e&&q(e)&&!ht.test(e)&&!pt.test(e)&&e.indexOf("#")!==0,Tt=e=>e.split(gt).filter(Boolean),Q=class{constructor(t,r,n,i,a,f){this.pattern=t,this.mark=r,this.negative=a,P(this,"body",n),P(this,"ignoreCase",i),P(this,"regexPrefix",f)}get regex(){let t=me+S;return this[t]?this[t]:this._make(S,t)}get checkRegex(){let t=me+F;return this[t]?this[t]:this._make(F,t)}_make(t,r){let n=this.regexPrefix.replace(Et,xt[t]),i=this.ignoreCase?new RegExp(n,"i"):new RegExp(n);return P(this,r,i)}},St=({pattern:e,mark:t},r)=>{let n=!1,i=e;i.indexOf("!")===0&&(n=!0,i=i.substr(1)),i=i.replace(dt,"!").replace(mt,"#");let a=Ot(i);return new Q(e,t,i,r,n,a)},K=class{constructor(t){this._ignoreCase=t,this._rules=[]}_add(t){if(t&&t[ke]){this._rules=this._rules.concat(t._rules._rules),this._added=!0;return}if(q(t)&&(t={pattern:t}),Pt(t.pattern)){let r=St(t,this._ignoreCase);this._added=!0,this._rules.push(r)}}add(t){return this._added=!1,ge(q(t)?Tt(t):t).forEach(this._add,this),this._added}test(t,r,n){let i=!1,a=!1,f;this._rules.forEach(s=>{let{negative:u}=s;a===u&&i!==a||u&&!i&&!a&&!r||!s[n].test(t)||(i=!u,a=u,f=u?lt:s)});let o={ignored:i,unignored:a};return f&&(o.rule=f),o}},At=(e,t)=>{throw new t(e)},k=(e,t,r)=>q(e)?e?k.isNotRelative(e)?r(`path should be a \`path.relative()\`d string, but got "${t}"`,RangeError):!0:r("path must not be empty",TypeError):r(`path must be a string, but got \`${t}\``,TypeError),_e=e=>wt.test(e);k.isNotRelative=_e;k.convert=e=>e;var V=class{constructor({ignorecase:t=!0,ignoreCase:r=t,allowRelativePaths:n=!1}={}){P(this,ke,!0),this._rules=new K(r),this._strictPathCheck=!n,this._initCache()}_initCache(){this._ignoreCache=Object.create(null),this._testCache=Object.create(null)}add(t){return this._rules.add(t)&&this._initCache(),this}addPattern(t){return this.add(t)}_test(t,r,n,i){let a=t&&k.convert(t);return k(a,t,this._strictPathCheck?At:be),this._t(a,r,n,i)}checkIgnore(t){if(!kt.test(t))return this.test(t);let r=t.split(O).filter(Boolean);if(r.pop(),r.length){let n=this._t(r.join(O)+O,this._testCache,!0,r);if(n.ignored)return n}return this._rules.test(t,!1,F)}_t(t,r,n,i){if(t in r)return r[t];if(i||(i=t.split(O).filter(Boolean)),i.pop(),!i.length)return r[t]=this._rules.test(t,n,S);let a=this._t(i.join(O)+O,r,n,i);return r[t]=a.ignored?a:this._rules.test(t,n,S)}ignores(t){return this._test(t,this._ignoreCache,!1).ignored}createFilter(){return t=>!this.ignores(t)}filter(t){return ge(t).filter(this.createFilter())}test(t){return this._test(t,this._testCache,!0)}},Y=e=>new V(e),Rt=e=>k(e&&k.convert(e),e,be),ye=()=>{let e=r=>/^\\\\\?\\/.test(r)||/["<>|\u0000-\u001F]+/u.test(r)?r:r.replace(/\\/g,"/");k.convert=e;let t=/^[a-z]:\//i;k.isNotRelative=r=>t.test(r)||_e(r)};typeof process<"u"&&process.platform==="win32"&&ye();U.exports=Y;Y.default=Y;U.exports.isPathValid=Rt;P(U.exports,Symbol.for("setupWindows"),ye)});var xe=m((ur,Ee)=>{"use strict";var Lt=require("path");Ee.exports.rgPath=Lt.join(__dirname,`../bin/rg${process.platform==="win32"?".exe":""}`)});var H=m((Ar,v)=>{var Se=function(e){return typeof e<"u"&&e.versions!=null&&e.versions.node!=null&&e+""=="[object process]"};v.exports.isNode=Se;v.exports.platform=typeof process<"u"&&Se(process)?"node":"browser";var Te=v.exports.platform==="node"&&require("worker_threads");v.exports.isMainThread=v.exports.platform==="node"?(!Te||Te.isMainThread)&&!process.connected:typeof Window<"u";v.exports.cpus=v.exports.platform==="browser"?self.navigator.hardwareConcurrency:require("os").cpus().length});var W=m(Re=>{"use strict";function d(e,t){var r=this;if(!(this instanceof d))throw new SyntaxError("Constructor must be called with the new operator");if(typeof e!="function")throw new SyntaxError("Function parameter handler(resolve, reject) missing");var n=[],i=[];this.resolved=!1,this.rejected=!1,this.pending=!0,this[Symbol.toStringTag]="Promise";var a=function(s,u){n.push(s),i.push(u)};this.then=function(s,u){return new d(function(l,p){var _=s?Ae(s,l,p):l,w=u?Ae(u,l,p):p;a(_,w)},r)};var f=function(s){return r.resolved=!0,r.rejected=!1,r.pending=!1,n.forEach(function(u){u(s)}),a=function(u,l){u(s)},f=o=function(){},r},o=function(s){return r.resolved=!1,r.rejected=!0,r.pending=!1,i.forEach(function(u){u(s)}),a=function(u,l){l(s)},f=o=function(){},r};this.cancel=function(){return t?t.cancel():o(new A),r},this.timeout=function(s){if(t)t.timeout(s);else{var u=setTimeout(function(){o(new R("Promise timed out after "+s+" ms"))},s);r.always(function(){clearTimeout(u)})}return r},e(function(s){f(s)},function(s){o(s)})}function Ae(e,t,r){return function(n){try{var i=e(n);i&&typeof i.then=="function"&&typeof i.catch=="function"?i.then(t,r):t(i)}catch(a){r(a)}}}d.prototype.catch=function(e){return this.then(null,e)};d.prototype.always=function(e){return this.then(e,e)};d.prototype.finally=function(e){let t=this,r=function(){return new d(n=>n()).then(e).then(()=>t)};return this.then(r,r)};d.all=function(e){return new d(function(t,r){var n=e.length,i=[];n?e.forEach(function(a,f){a.then(function(o){i[f]=o,n--,n==0&&t(i)},function(o){n=0,r(o)})}):t(i)})};d.defer=function(){var e={};return e.promise=new d(function(t,r){e.resolve=t,e.reject=r}),e};function A(e){this.message=e||"promise cancelled",this.stack=new Error().stack}A.prototype=new Error;A.prototype.constructor=Error;A.prototype.name="CancellationError";d.CancellationError=A;function R(e){this.message=e||"timeout exceeded",this.stack=new Error().stack}R.prototype=new Error;R.prototype.constructor=Error;R.prototype.name="TimeoutError";d.TimeoutError=R;Re.Promise=d});var We=m(L=>{L.validateOptions=function(t,r,n){if(t){var i=t?Object.keys(t):[],a=i.find(o=>!r.includes(o));if(a)throw new Error('Object "'+n+'" contains an unknown option "'+a+'"');var f=r.find(o=>Object.prototype[o]&&!i.includes(o));if(f)throw new Error('Object "'+n+'" contains an inherited option "'+f+'" which is not defined in the object itself but in its prototype. Only plain objects are allowed. Please remove the option from the prototype or override it with a value "undefined".');return t}};L.workerOptsNames=["credentials","name","type"];L.forkOptsNames=["cwd","detached","env","execPath","execArgv","gid","serialization","signal","killSignal","silent","stdio","uid","windowsVerbatimArguments","timeout"];L.workerThreadOptsNames=["argv","env","eval","execArgv","stdin","stdout","stderr","workerData","trackUnmanagedFds","transferList","resourceLimits","name"]});var Ne=m((Lr,Le)=>{Le.exports=`!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).worker=n()}(this,(function(){"use strict";function e(n){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(n)}function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var t={};var r=function(e,n){this.message=e,this.transfer=n},o={};function i(e,n){var t=this;if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if("function"!=typeof e)throw new SyntaxError("Function parameter handler(resolve, reject) missing");var r=[],o=[];this.resolved=!1,this.rejected=!1,this.pending=!0,this[Symbol.toStringTag]="Promise";var a=function(e,n){r.push(e),o.push(n)};this.then=function(e,n){return new i((function(t,r){var o=e?s(e,t,r):t,i=n?s(n,t,r):r;a(o,i)}),t)};var f=function(e){return t.resolved=!0,t.rejected=!1,t.pending=!1,r.forEach((function(n){n(e)})),a=function(n,t){n(e)},f=d=function(){},t},d=function(e){return t.resolved=!1,t.rejected=!0,t.pending=!1,o.forEach((function(n){n(e)})),a=function(n,t){t(e)},f=d=function(){},t};this.cancel=function(){return n?n.cancel():d(new u),t},this.timeout=function(e){if(n)n.timeout(e);else{var r=setTimeout((function(){d(new c("Promise timed out after "+e+" ms"))}),e);t.always((function(){clearTimeout(r)}))}return t},e((function(e){f(e)}),(function(e){d(e)}))}function s(e,n,t){return function(r){try{var o=e(r);o&&"function"==typeof o.then&&"function"==typeof o.catch?o.then(n,t):n(o)}catch(e){t(e)}}}function u(e){this.message=e||"promise cancelled",this.stack=(new Error).stack}function c(e){this.message=e||"timeout exceeded",this.stack=(new Error).stack}return i.prototype.catch=function(e){return this.then(null,e)},i.prototype.always=function(e){return this.then(e,e)},i.prototype.finally=function(e){var n=this,t=function(){return new i((function(e){return e()})).then(e).then((function(){return n}))};return this.then(t,t)},i.all=function(e){return new i((function(n,t){var r=e.length,o=[];r?e.forEach((function(e,i){e.then((function(e){o[i]=e,0==--r&&n(o)}),(function(e){r=0,t(e)}))})):n(o)}))},i.defer=function(){var e={};return e.promise=new i((function(n,t){e.resolve=n,e.reject=t})),e},u.prototype=new Error,u.prototype.constructor=Error,u.prototype.name="CancellationError",i.CancellationError=u,c.prototype=new Error,c.prototype.constructor=Error,c.prototype.name="TimeoutError",i.TimeoutError=c,o.Promise=i,function(n){var t=r,i=o.Promise,s="__workerpool-cleanup__",u={exit:function(){}},c={addAbortListener:function(e){u.abortListeners.push(e)},emit:u.emit};if("undefined"!=typeof self&&"function"==typeof postMessage&&"function"==typeof addEventListener)u.on=function(e,n){addEventListener(e,(function(e){n(e.data)}))},u.send=function(e,n){n?postMessage(e,n):postMessage(e)};else{if("undefined"==typeof process)throw new Error("Script must be executed as a worker");var a;try{a=require("worker_threads")}catch(n){if("object"!==e(n)||null===n||"MODULE_NOT_FOUND"!==n.code)throw n}if(a&&null!==a.parentPort){var f=a.parentPort;u.send=f.postMessage.bind(f),u.on=f.on.bind(f),u.exit=process.exit.bind(process)}else u.on=process.on.bind(process),u.send=function(e){process.send(e)},u.on("disconnect",(function(){process.exit(1)})),u.exit=process.exit.bind(process)}function d(e){return e&&e.toJSON?JSON.parse(JSON.stringify(e)):JSON.parse(JSON.stringify(e,Object.getOwnPropertyNames(e)))}function l(e){return e&&"function"==typeof e.then&&"function"==typeof e.catch}u.methods={},u.methods.run=function(e,n){var t=new Function("return ("+e+").apply(this, arguments);");return t.worker=c,t.apply(t,n)},u.methods.methods=function(){return Object.keys(u.methods)},u.terminationHandler=void 0,u.abortListenerTimeout=1e3,u.abortListeners=[],u.terminateAndExit=function(e){var n=function(){u.exit(e)};if(!u.terminationHandler)return n();var t=u.terminationHandler(e);return l(t)?(t.then(n,n),t):(n(),new i((function(e,n){n(new Error("Worker terminating"))})))},u.cleanup=function(e){if(!u.abortListeners.length)return u.send({id:e,method:s,error:d(new Error("Worker terminating"))}),new i((function(e){e()}));var n,t=u.abortListeners.map((function(e){return e()})),r=new i((function(e,t){n=setTimeout((function(){t(new Error("Timeout occured waiting for abort handler, killing worker"))}),u.abortListenerTimeout)})),o=i.all(t).then((function(){clearTimeout(n),u.abortListeners.length||(u.abortListeners=[])}),(function(){clearTimeout(n),u.exit()}));return new i((function(e,n){o.then(e,n),r.then(e,n)})).then((function(){u.send({id:e,method:s,error:null})}),(function(n){u.send({id:e,method:s,error:n?d(n):null})}))};var p=null;u.on("message",(function(e){if("__workerpool-terminate__"===e)return u.terminateAndExit(0);if(e.method===s)return u.cleanup(e.id);try{var n=u.methods[e.method];if(!n)throw new Error('Unknown method "'+e.method+'"');p=e.id;var r=n.apply(n,e.params);l(r)?r.then((function(n){n instanceof t?u.send({id:e.id,result:n.message,error:null},n.transfer):u.send({id:e.id,result:n,error:null}),p=null})).catch((function(n){u.send({id:e.id,result:null,error:d(n)}),p=null})):(r instanceof t?u.send({id:e.id,result:r.message,error:null},r.transfer):u.send({id:e.id,result:r,error:null}),p=null)}catch(n){u.send({id:e.id,result:null,error:d(n)})}})),u.register=function(e,n){if(e)for(var t in e)e.hasOwnProperty(t)&&(u.methods[t]=e[t],u.methods[t].worker=c);n&&(u.terminationHandler=n.onTerminate,u.abortListenerTimeout=n.abortListenerTimeout||1e3),u.send("ready")},u.emit=function(e){if(p){if(e instanceof t)return void u.send({id:p,isEvent:!0,payload:e.message},e.transfer);u.send({id:p,isEvent:!0,payload:e})}},n.add=u.register,n.emit=u.emit}(t),n(t)}));
//# sourceMappingURL=worker.min.js.map
`});var He=m((Nr,E)=>{"use strict";var{Promise:N}=W(),De=H(),{validateOptions:ie,forkOptsNames:jt,workerThreadOptsNames:Mt,workerOptsNames:$t}=We(),Ce="__workerpool-terminate__",Fe="__workerpool-cleanup__";function qe(){var e=oe();if(!e)throw new Error("WorkerPool: workerType = 'thread' is not supported, Node >= 11.7.0 required");return e}function je(){if(typeof Worker!="function"&&(typeof Worker!="object"||typeof Worker.prototype.constructor!="function"))throw new Error("WorkerPool: Web Workers not supported")}function oe(){try{return require("worker_threads")}catch(e){if(typeof e=="object"&&e!==null&&e.code==="MODULE_NOT_FOUND")return null;throw e}}function It(){if(De.platform==="browser"){if(typeof Blob>"u")throw new Error("Blob not supported by the browser");if(!window.URL||typeof window.URL.createObjectURL!="function")throw new Error("URL.createObjectURL not supported by the browser");var e=new Blob([Ne()],{type:"text/javascript"});return window.URL.createObjectURL(e)}else return __dirname+"/worker.js"}function Dt(e,t){if(t.workerType==="web")return je(),te(e,t.workerOpts,Worker);if(t.workerType==="thread")return r=qe(),re(e,r,t);if(t.workerType==="process"||!t.workerType)return ne(e,Me(t),require("child_process"));if(De.platform==="browser")return je(),te(e,t.workerOpts,Worker);var r=oe();return r?re(e,r,t):ne(e,Me(t),require("child_process"))}function te(e,t,r){ie(t,$t,"workerOpts");var n=new r(e,t);return n.isBrowserWorker=!0,n.on=function(i,a){this.addEventListener(i,function(f){a(f.data)})},n.send=function(i,a){this.postMessage(i,a)},n}function re(e,t,r){ie(r?.workerThreadOpts,Mt,"workerThreadOpts");var n=new t.Worker(e,{stdout:r?.emitStdStreams??!1,stderr:r?.emitStdStreams??!1,...r?.workerThreadOpts});return n.isWorkerThread=!0,n.send=function(i,a){this.postMessage(i,a)},n.kill=function(){return this.terminate(),!0},n.disconnect=function(){this.terminate()},r?.emitStdStreams&&(n.stdout.on("data",i=>n.emit("stdout",i)),n.stderr.on("data",i=>n.emit("stderr",i))),n}function ne(e,t,r){ie(t.forkOpts,jt,"forkOpts");var n=r.fork(e,t.forkArgs,t.forkOpts),i=n.send;return n.send=function(a){return i.call(n,a)},t.emitStdStreams&&(n.stdout.on("data",a=>n.emit("stdout",a)),n.stderr.on("data",a=>n.emit("stderr",a))),n.isChildProcess=!0,n}function Me(e){e=e||{};var t=process.execArgv.join(" "),r=t.indexOf("--inspect")!==-1,n=t.indexOf("--debug-brk")!==-1,i=[];return r&&(i.push("--inspect="+e.debugPort),n&&i.push("--debug-brk")),process.execArgv.forEach(function(a){a.indexOf("--max-old-space-size")>-1&&i.push(a)}),Object.assign({},e,{forkArgs:e.forkArgs,forkOpts:Object.assign({},e.forkOpts,{execArgv:(e.forkOpts&&e.forkOpts.execArgv||[]).concat(i),stdio:e.emitStdStreams?"pipe":void 0})})}function $e(e){for(var t=new Error(""),r=Object.keys(e),n=0;n<r.length;n++)t[r[n]]=e[r[n]];return t}function Ie(e,t){Object.values(e.processing).forEach(r=>r?.options?.on(t)),Object.values(e.tracking).forEach(r=>r?.options?.on(t))}function T(e,t){var r=this,n=t||{};this.script=e||It(),this.worker=Dt(this.script,n),this.debugPort=n.debugPort,this.forkOpts=n.forkOpts,this.forkArgs=n.forkArgs,this.workerOpts=n.workerOpts,this.workerThreadOpts=n.workerThreadOpts,this.workerTerminateTimeout=n.workerTerminateTimeout,e||(this.worker.ready=!0),this.requestQueue=[],this.worker.on("stdout",function(o){Ie(r,{stdout:o.toString()})}),this.worker.on("stderr",function(o){Ie(r,{stderr:o.toString()})}),this.worker.on("message",function(o){if(!r.terminated)if(typeof o=="string"&&o==="ready")r.worker.ready=!0,a();else{var s=o.id,u=r.processing[s];if(u!==void 0)o.isEvent?u.options&&typeof u.options.on=="function"&&u.options.on(o.payload):(delete r.processing[s],r.terminating===!0&&r.terminate(),o.error?u.resolver.reject($e(o.error)):u.resolver.resolve(o.result));else{var u=r.tracking[s];u!==void 0&&o.isEvent&&u.options&&typeof u.options.on=="function"&&u.options.on(o.payload)}if(o.method===Fe){var l=r.tracking[o.id];l!==void 0&&(o.error?(clearTimeout(l.timeoutId),l.resolver.reject($e(o.error))):(r.tracking&&clearTimeout(l.timeoutId),l.resolver.reject(new Ue(l.error)))),delete r.tracking[s]}}});function i(o){r.terminated=!0;for(var s in r.processing)r.processing[s]!==void 0&&r.processing[s].resolver.reject(o);r.processing=Object.create(null)}function a(){for(let o of r.requestQueue.splice(0))r.worker.send(o.message,o.transfer)}var f=this.worker;this.worker.on("error",i),this.worker.on("exit",function(o,s){var u=`Workerpool Worker terminated Unexpectedly
`;u+="    exitCode: `"+o+"`\n",u+="    signalCode: `"+s+"`\n",u+="    workerpool.script: `"+r.script+"`\n",u+="    spawnArgs: `"+f.spawnargs+"`\n",u+="    spawnfile: `"+f.spawnfile+"`\n",u+="    stdout: `"+f.stdout+"`\n",u+="    stderr: `"+f.stderr+"`\n",i(new Error(u))}),this.processing=Object.create(null),this.tracking=Object.create(null),this.terminating=!1,this.terminated=!1,this.cleaning=!1,this.terminationHandler=null,this.lastId=0}T.prototype.methods=function(){return this.exec("methods")};T.prototype.exec=function(e,t,r,n){r||(r=N.defer());var i=++this.lastId;this.processing[i]={id:i,resolver:r,options:n};var a={message:{id:i,method:e,params:t},transfer:n&&n.transfer};this.terminated?r.reject(new Error("Worker is terminated")):this.worker.ready?this.worker.send(a.message,a.transfer):this.requestQueue.push(a);var f=this;return r.promise.catch(function(o){if(o instanceof N.CancellationError||o instanceof N.TimeoutError)return f.tracking[i]={id:i,resolver:N.defer(),options:n,error:o},delete f.processing[i],f.tracking[i].resolver.promise=f.tracking[i].resolver.promise.catch(function(s){if(delete f.tracking[i],s instanceof Ue)throw s.error;var u=f.terminateAndNotify(!0).then(function(){throw s},function(l){throw l});return u}),f.worker.send({id:i,method:Fe}),f.tracking[i].timeoutId=setTimeout(function(){f.tracking[i].resolver.reject(o)},f.workerTerminateTimeout),f.tracking[i].resolver.promise;throw o})};T.prototype.busy=function(){return this.cleaning||Object.keys(this.processing).length>0};T.prototype.terminate=function(e,t){var r=this;if(e){for(var n in this.processing)this.processing[n]!==void 0&&this.processing[n].resolver.reject(new Error("Worker terminated"));this.processing=Object.create(null)}for(var i of Object.values(r.tracking))clearTimeout(i.timeoutId),i.resolver.reject(new Error("Worker Terminating"));if(r.tracking=Object.create(null),typeof t=="function"&&(this.terminationHandler=t),this.busy())this.terminating=!0;else{var a=function(o){if(r.terminated=!0,r.cleaning=!1,r.worker!=null&&r.worker.removeAllListeners&&r.worker.removeAllListeners("message"),r.worker=null,r.terminating=!1,r.terminationHandler)r.terminationHandler(o,r);else if(o)throw o};if(this.worker)if(typeof this.worker.kill=="function"){if(this.worker.killed){a(new Error("worker already killed!"));return}var f=setTimeout(function(){r.worker&&r.worker.kill()},this.workerTerminateTimeout);this.worker.once("exit",function(){clearTimeout(f),r.worker&&(r.worker.killed=!0),a()}),this.worker.ready?this.worker.send(Ce):this.requestQueue.push({message:Ce}),this.cleaning=!0;return}else if(typeof this.worker.terminate=="function")this.worker.terminate(),this.worker.killed=!0;else throw new Error("Failed to terminate worker");a()}};T.prototype.terminateAndNotify=function(e,t){var r=N.defer();return t&&r.promise.timeout(t),this.terminate(e,function(n,i){n?r.reject(n):r.resolve(i)}),r.promise};function Ue(e){this.error=e,this.stack=new Error().stack}E.exports=T;E.exports._tryRequireWorkerThreads=oe;E.exports._setupProcessWorker=ne;E.exports._setupBrowserWorker=te;E.exports._setupWorkerThreadWorker=re;E.exports.ensureWorkerThreads=qe});var Be=m((Cr,ze)=>{"use strict";var Ge=65535;ze.exports=se;function se(){this.ports=Object.create(null),this.length=0}se.prototype.nextAvailableStartingAt=function(e){for(;this.ports[e]===!0;)e++;if(e>=Ge)throw new Error("WorkerPool debug port limit reached: "+e+">= "+Ge);return this.ports[e]=!0,this.length++,e};se.prototype.releasePort=function(e){delete this.ports[e],this.length--}});var Ve=m((jr,Ke)=>{var{Promise:ae}=W(),Xe=He(),Ft=H(),qt=Be(),ue=new qt;function g(e,t){typeof e=="string"?this.script=e||null:(this.script=null,t=e),this.workers=[],this.tasks=[],t=t||{},this.forkArgs=Object.freeze(t.forkArgs||[]),this.forkOpts=Object.freeze(t.forkOpts||{}),this.workerOpts=Object.freeze(t.workerOpts||{}),this.workerThreadOpts=Object.freeze(t.workerThreadOpts||{}),this.debugPortStart=t.debugPortStart||43210,this.nodeWorker=t.nodeWorker,this.workerType=t.workerType||t.nodeWorker||"auto",this.maxQueueSize=t.maxQueueSize||1/0,this.workerTerminateTimeout=t.workerTerminateTimeout||1e3,this.onCreateWorker=t.onCreateWorker||(()=>null),this.onTerminateWorker=t.onTerminateWorker||(()=>null),this.emitStdStreams=t.emitStdStreams||!1,t&&"maxWorkers"in t?(Ut(t.maxWorkers),this.maxWorkers=t.maxWorkers):this.maxWorkers=Math.max((Ft.cpus||4)-1,1),t&&"minWorkers"in t&&(t.minWorkers==="max"?this.minWorkers=this.maxWorkers:(Ht(t.minWorkers),this.minWorkers=t.minWorkers,this.maxWorkers=Math.max(this.minWorkers,this.maxWorkers)),this._ensureMinWorkers()),this._boundNext=this._next.bind(this),this.workerType==="thread"&&Xe.ensureWorkerThreads()}g.prototype.exec=function(e,t,r){if(t&&!Array.isArray(t))throw new TypeError('Array expected as argument "params"');if(typeof e=="string"){var n=ae.defer();if(this.tasks.length>=this.maxQueueSize)throw new Error("Max queue size of "+this.maxQueueSize+" reached");var i=this.tasks,a={method:e,params:t,resolver:n,timeout:null,options:r};i.push(a);var f=n.promise.timeout;return n.promise.timeout=function(s){return i.indexOf(a)!==-1?(a.timeout=s,n.promise):f.call(n.promise,s)},this._next(),n.promise}else{if(typeof e=="function")return this.exec("run",[String(e),t],r);throw new TypeError('Function or string expected as argument "method"')}};g.prototype.proxy=function(){if(arguments.length>0)throw new Error("No arguments expected");var e=this;return this.exec("methods").then(function(t){var r={};return t.forEach(function(n){r[n]=function(){return e.exec(n,Array.prototype.slice.call(arguments))}}),r})};g.prototype._next=function(){if(this.tasks.length>0){var e=this._getWorker();if(e){var t=this,r=this.tasks.shift();if(r.resolver.promise.pending){var n=e.exec(r.method,r.params,r.resolver,r.options).then(t._boundNext).catch(function(){if(e.terminated)return t._removeWorker(e)}).then(function(){t._next()});typeof r.timeout=="number"&&n.timeout(r.timeout)}else t._next()}}};g.prototype._getWorker=function(){for(var e=this.workers,t=0;t<e.length;t++){var r=e[t];if(r.busy()===!1)return r}return e.length<this.maxWorkers?(r=this._createWorkerHandler(),e.push(r),r):null};g.prototype._removeWorker=function(e){var t=this;return ue.releasePort(e.debugPort),this._removeWorkerFromList(e),this._ensureMinWorkers(),new ae(function(r,n){e.terminate(!1,function(i){t.onTerminateWorker({forkArgs:e.forkArgs,forkOpts:e.forkOpts,workerThreadOpts:e.workerThreadOpts,script:e.script}),i?n(i):r(e)})})};g.prototype._removeWorkerFromList=function(e){var t=this.workers.indexOf(e);t!==-1&&this.workers.splice(t,1)};g.prototype.terminate=function(e,t){var r=this;this.tasks.forEach(function(o){o.resolver.reject(new Error("Pool terminated"))}),this.tasks.length=0;var n=function(o){ue.releasePort(o.debugPort),this._removeWorkerFromList(o)},i=n.bind(this),a=[],f=this.workers.slice();return f.forEach(function(o){var s=o.terminateAndNotify(e,t).then(i).always(function(){r.onTerminateWorker({forkArgs:o.forkArgs,forkOpts:o.forkOpts,workerThreadOpts:o.workerThreadOpts,script:o.script})});a.push(s)}),ae.all(a)};g.prototype.stats=function(){var e=this.workers.length,t=this.workers.filter(function(r){return r.busy()}).length;return{totalWorkers:e,busyWorkers:t,idleWorkers:e-t,pendingTasks:this.tasks.length,activeTasks:t}};g.prototype._ensureMinWorkers=function(){if(this.minWorkers)for(var e=this.workers.length;e<this.minWorkers;e++)this.workers.push(this._createWorkerHandler())};g.prototype._createWorkerHandler=function(){let e=this.onCreateWorker({forkArgs:this.forkArgs,forkOpts:this.forkOpts,workerOpts:this.workerOpts,workerThreadOpts:this.workerThreadOpts,script:this.script})||{};return new Xe(e.script||this.script,{forkArgs:e.forkArgs||this.forkArgs,forkOpts:e.forkOpts||this.forkOpts,workerOpts:e.workerOpts||this.workerOpts,workerThreadOpts:e.workerThreadOpts||this.workerThreadOpts,debugPort:ue.nextAvailableStartingAt(this.debugPortStart),workerType:this.workerType,workerTerminateTimeout:this.workerTerminateTimeout,emitStdStreams:this.emitStdStreams})};function Ut(e){if(!Je(e)||!Qe(e)||e<1)throw new TypeError("Option maxWorkers must be an integer number >= 1")}function Ht(e){if(!Je(e)||!Qe(e)||e<0)throw new TypeError("Option minWorkers must be an integer number >= 0")}function Je(e){return typeof e=="number"}function Qe(e){return Math.round(e)==e}Ke.exports=g});var ce=m((Mr,Ye)=>{function Gt(e,t){this.message=e,this.transfer=t}Ye.exports=Gt});var le=m(z=>{var fe=ce(),M=W().Promise,zt="__workerpool-terminate__",G="__workerpool-cleanup__",Ze=1e3,c={exit:function(){}},et={addAbortListener:function(e){c.abortListeners.push(e)},emit:c.emit};if(typeof self<"u"&&typeof postMessage=="function"&&typeof addEventListener=="function")c.on=function(e,t){addEventListener(e,function(r){t(r.data)})},c.send=function(e,t){t?postMessage(e,t):postMessage(e)};else if(typeof process<"u"){try{C=require("worker_threads")}catch(e){if(!(typeof e=="object"&&e!==null&&e.code==="MODULE_NOT_FOUND"))throw e}C&&C.parentPort!==null?(j=C.parentPort,c.send=j.postMessage.bind(j),c.on=j.on.bind(j),c.exit=process.exit.bind(process)):(c.on=process.on.bind(process),c.send=function(e){process.send(e)},c.on("disconnect",function(){process.exit(1)}),c.exit=process.exit.bind(process))}else throw new Error("Script must be executed as a worker");var C,j;function B(e){return e&&e.toJSON?JSON.parse(JSON.stringify(e)):JSON.parse(JSON.stringify(e,Object.getOwnPropertyNames(e)))}function tt(e){return e&&typeof e.then=="function"&&typeof e.catch=="function"}c.methods={};c.methods.run=function(t,r){var n=new Function("return ("+t+").apply(this, arguments);");return n.worker=et,n.apply(n,r)};c.methods.methods=function(){return Object.keys(c.methods)};c.terminationHandler=void 0;c.abortListenerTimeout=Ze;c.abortListeners=[];c.terminateAndExit=function(e){var t=function(){c.exit(e)};if(!c.terminationHandler)return t();var r=c.terminationHandler(e);return tt(r)?(r.then(t,t),r):(t(),new M(function(n,i){i(new Error("Worker terminating"))}))};c.cleanup=function(e){if(!c.abortListeners.length)return c.send({id:e,method:G,error:B(new Error("Worker terminating"))}),new M(function(o){o()});var t=function(){c.exit()},r=function(){c.abortListeners.length||(c.abortListeners=[])};let n=c.abortListeners.map(o=>o()),i,a=new M((o,s)=>{i=setTimeout(function(){s(new Error("Timeout occured waiting for abort handler, killing worker"))},c.abortListenerTimeout)}),f=M.all(n).then(function(){clearTimeout(i),r()},function(){clearTimeout(i),t()});return new M(function(o,s){f.then(o,s),a.then(o,s)}).then(function(){c.send({id:e,method:G,error:null})},function(o){c.send({id:e,method:G,error:o?B(o):null})})};var x=null;c.on("message",function(e){if(e===zt)return c.terminateAndExit(0);if(e.method===G)return c.cleanup(e.id);try{var t=c.methods[e.method];if(t){x=e.id;var r=t.apply(t,e.params);tt(r)?r.then(function(n){n instanceof fe?c.send({id:e.id,result:n.message,error:null},n.transfer):c.send({id:e.id,result:n,error:null}),x=null}).catch(function(n){c.send({id:e.id,result:null,error:B(n)}),x=null}):(r instanceof fe?c.send({id:e.id,result:r.message,error:null},r.transfer):c.send({id:e.id,result:r,error:null}),x=null)}else throw new Error('Unknown method "'+e.method+'"')}catch(n){c.send({id:e.id,result:null,error:B(n)})}});c.register=function(e,t){if(e)for(var r in e)e.hasOwnProperty(r)&&(c.methods[r]=e[r],c.methods[r].worker=et);t&&(c.terminationHandler=t.onTerminate,c.abortListenerTimeout=t.abortListenerTimeout||Ze),c.send("ready")};c.emit=function(e){if(x){if(e instanceof fe){c.send({id:x,isEvent:!0,payload:e.message},e.transfer);return}c.send({id:x,isEvent:!0,payload:e})}};typeof z<"u"&&(z.add=c.register,z.emit=c.emit)});var rt=m(b=>{var{platform:Bt,isMainThread:Xt,cpus:Jt}=H();function Qt(e,t){var r=Ve();return new r(e,t)}b.pool=Qt;function Kt(e,t){var r=le();r.add(e,t)}b.worker=Kt;function Vt(e){var t=le();t.emit(e)}b.workerEmit=Vt;var{Promise:Yt}=W();b.Promise=Yt;b.Transfer=ce();b.platform=Bt;b.isMainThread=Xt;b.cpus=Jt});var y=$(require("path"),1);var I={POSIX:0,WINDOWS:1};var D=class e{constructor(t,r,n){this._absolutePath=t;this._isDirectory=r;this._platform=n;n===I.WINDOWS?this._path=y.win32:this._path=y.posix}_path;static getAbsolutePath(t,r){return t?e.normalizeToPlatformPath(t.absolutePath,r):""}static equals(t,r){return t.absPath===r.absPath}static includes(t,r){return t.some(n=>e.equals(n,r))}static getFileName(t,r){let n=this.normalizeToPlatformPath(t,r);return(r===I.WINDOWS?y.win32:y.posix).basename(n)}static normalizeToPlatformPath(t,r){return r===I.WINDOWS?y.win32.normalize(t):y.posix.normalize(t)}get isDirectory(){return this._isDirectory}get platform(){return this._platform}get absPath(){return this._absolutePath}get name(){return this._path.basename(this.absPath)}get proto(){return{absolutePath:this.absPath,isDirectory:this.isDirectory}}get tiptapState(){return{id:this.absPath,label:this.name,absolutePath:this.absPath}}static EMPTY_WORKSPACE=""};function pe(e,t,r=50){let n=new Map,i=s=>n.get(s)??[],a=new Set(t.map(s=>e(s.path))).size,f=a>0?Math.ceil(r/a):0,o=0;for(let s of t){if(o>=r)break;let u=e(s.path);if(Math.min(f-i(u).length,r-o)>0){let p=i(u);n.set(u,p.concat(s)),o+=1}}return Array.from(n.values()).flat()}var Wt=$(ve(),1),Z=[".git/",".svn/",".hg/",".cvs/",".vscode/",".idea/",".vs/",".eclipse/",".settings/","node_modules/",".yarn/","pip-wheel-metadata/",".pnpm/","venv/",".venv/","env/",".env/","site-packages/",".bundle/",".gradle/",".mvn/","dist/","build/","Build/","target/","out/","bin/","obj/",".output/",".next/",".nuxt/",".cache/",".parcel-cache/",".coverage/",".nyc_output/",".pytest_cache/",".vscode-test/",".continue/","__pycache__/",".mypy_cache/",".ipynb_checkpoints/",".phpunit.cache/",".sass-cache/","tmp/cache/",".gradle-build/",".nx/",".rush/",".turbo/",".verdaccio/",".helm/",".terraform/","gems/","vendor/"],ee=["*.DS_Store","*-lock.json","*.lock","go.sum","go.mod","*.log","npm-debug.log*","yarn-debug.log*","yarn-error.log*","debug.log","lerna-debug.log","*.tsbuildinfo","*.js.map","*.min.js","*.min.css","*.d.ts","*.map","*.bundle.js","*.bundle.css","*.bundle.min.js","*.bundle.min.css","dependency-reduced-pom.xml","gradle-wrapper.jar","maven-wrapper.jar","composer.phar","*.py[cod]","*.so","*.egg*","*.mo","celerybeat-schedule*","*.userprefs","*.tmp","*.temp","thumbs.db","*.swp","*.swo","~$*",".project",".classpath",".factorypath","*.sublime-*","*.ttf","*.png","*.jpg","*.jpeg","*.gif","*.mp4","*.svg","*.ico","*.pdf","*.woff","*.woff2","*.eot","*.cur","*.avi","*.mpg","*.mpeg","*.mov","*.mp3","*.mkv","*.webm","*.wav","*.webp","*.zip","*.gz","*.tar","*.dmg","*.tgz","*.rar","*.7z","*.exe","*.dll","*.obj","*.o","*.o.d","*.a","*.lib","*.dylib","*.ncb","*.sdf","*.jar","*.onnx","*.wasm","*.plist","*.profraw","*.gcda","*.gcno","*.pdb","*.bin","*.parquet","*.pqt","*.db","*.sqlite","*.csv","*.uasset","*.shp","*.shx","*.dbf","*.env","*.gitignore","*.gitkeep","*.continueignore","config.json"],sr=[...Z,...ee];var Nt=$(xe(),1);var Oe=/^win/.test(process.platform);var h=Oe?'"':"'",fr=["--files","--no-require-git","--hidden","-g",`${h}!**/.git${h}`,"-g",`${h}!**/.svn${h}`,"-g",`${h}!**/.hg${h}`,"-g",`${h}!**/CVS${h}`,"-g",`${h}!**/.DS_Store${h}`,"-g",`${h}!**/Thumbs.db${h}`,...ee.flatMap(e=>["-g",`${h}!${e}${h}`]),...Z.flatMap(e=>["-g",`${h}!${e}${h}`])];var Ct=5e3;async function Pe(e,t,r){let n=[],i=(o,s)=>{try{let u=[...o.before,o.match,...o.after];if(u.map(w=>w.text).join(`
`).length>Ct)return;u.sort((w,it)=>w.lineNumber-it.lineNumber);let l=u.length>0?u[0].lineNumber:o.match.lineNumber,p=u.length,_={path:{absolutePath:s,isDirectory:!1},content:u.map(w=>w.text).join(`
`),range:{startLine:l,count:p},summary:"",diagnostics:[]};n.push(_)}catch(u){console.warn("Error processing file path in ripgrep output",{error:u,path:s})}},a={};for(let o of e.split(`
`))if(o.trim())try{let s=JSON.parse(o);if(s.type==="summary"){console.debug("Ripgrep search summary",{totalTime:s.data.elapsed_total.human,matches:s.data.stats.matches,matchedLines:s.data.stats.matched_lines,bytesSearched:s.data.stats.bytes_searched});continue}let u=s.data?.path?.text;if(!u)continue;a[u]||(a[u]={preBuffer:[],pendingMatches:[]});let l=a[u];if(s.type==="context"&&s.data?.line_number){let p={text:s.data.lines.text,lineNumber:s.data.line_number},_=l.pendingMatches[0];_?_.after.push(p):l.preBuffer.push(p)}else if(s.type==="match"&&u){if(l.pendingMatches.length>0){let w=l.pendingMatches.shift();w&&i(w,u)}let p={text:s.data.lines.text,lineNumber:s.data.line_number},_={before:[...l.preBuffer],match:p,after:[]};l.pendingMatches.push(_),l.preBuffer=[]}else if(s.type==="end"&&a[u]){for(;l.pendingMatches.length>0;){let p=l.pendingMatches.shift();p&&i(p,u)}a[u]={preBuffer:[],pendingMatches:[]}}}catch(s){let u=`Error parsing ripgrep JSON output: ${s}`;throw console.warn(u),new Error(u)}for(let o in a){let s=a[o];for(;s.pendingMatches.length>0;){let u=s.pendingMatches.shift();u&&i(u,o)}}return pe(o=>D.getAbsolutePath(o,r),n,50)}var nt=$(rt());nt.worker({processRipgrepOutput:Pe});
