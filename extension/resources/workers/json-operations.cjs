"use strict";var xe=Object.create;var z=Object.defineProperty;var We=Object.getOwnPropertyDescriptor;var _e=Object.getOwnPropertyNames;var Se=Object.getPrototypeOf,je=Object.prototype.hasOwnProperty;var p=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports);var Ae=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of _e(r))!je.call(e,o)&&o!==t&&z(e,o,{get:()=>r[o],enumerable:!(n=We(r,o))||n.enumerable});return e};var Le=(e,r,t)=>(t=e!=null?xe(Se(e)):{},Ae(r||!e||!e.__esModule?z(t,"default",{value:e,enumerable:!0}):t,e));var S=p(($e,k)=>{var Q=function(e){return typeof e<"u"&&e.versions!=null&&e.versions.node!=null&&e+""=="[object process]"};k.exports.isNode=Q;k.exports.platform=typeof process<"u"&&Q(process)?"node":"browser";var B=k.exports.platform==="node"&&require("worker_threads");k.exports.isMainThread=k.exports.platform==="node"?(!B||B.isMainThread)&&!process.connected:typeof Window<"u";k.exports.cpus=k.exports.platform==="browser"?self.navigator.hardwareConcurrency:require("os").cpus().length});var O=p(V=>{"use strict";function l(e,r){var t=this;if(!(this instanceof l))throw new SyntaxError("Constructor must be called with the new operator");if(typeof e!="function")throw new SyntaxError("Function parameter handler(resolve, reject) missing");var n=[],o=[];this.resolved=!1,this.rejected=!1,this.pending=!0,this[Symbol.toStringTag]="Promise";var u=function(a,f){n.push(a),o.push(f)};this.then=function(a,f){return new l(function(d,P){var Te=a?G(a,d,P):d,Ee=f?G(f,d,P):P;u(Te,Ee)},t)};var c=function(a){return t.resolved=!0,t.rejected=!1,t.pending=!1,n.forEach(function(f){f(a)}),u=function(f,d){f(a)},c=i=function(){},t},i=function(a){return t.resolved=!1,t.rejected=!0,t.pending=!1,o.forEach(function(f){f(a)}),u=function(f,d){d(a)},c=i=function(){},t};this.cancel=function(){return r?r.cancel():i(new y),t},this.timeout=function(a){if(r)r.timeout(a);else{var f=setTimeout(function(){i(new b("Promise timed out after "+a+" ms"))},a);t.always(function(){clearTimeout(f)})}return t},e(function(a){c(a)},function(a){i(a)})}function G(e,r,t){return function(n){try{var o=e(n);o&&typeof o.then=="function"&&typeof o.catch=="function"?o.then(r,t):r(o)}catch(u){t(u)}}}l.prototype.catch=function(e){return this.then(null,e)};l.prototype.always=function(e){return this.then(e,e)};l.prototype.finally=function(e){let r=this,t=function(){return new l(n=>n()).then(e).then(()=>r)};return this.then(t,t)};l.all=function(e){return new l(function(r,t){var n=e.length,o=[];n?e.forEach(function(u,c){u.then(function(i){o[c]=i,n--,n==0&&r(o)},function(i){n=0,t(i)})}):r(o)})};l.defer=function(){var e={};return e.promise=new l(function(r,t){e.resolve=r,e.reject=t}),e};function y(e){this.message=e||"promise cancelled",this.stack=new Error().stack}y.prototype=new Error;y.prototype.constructor=Error;y.prototype.name="CancellationError";l.CancellationError=y;function b(e){this.message=e||"timeout exceeded",this.stack=new Error().stack}b.prototype=new Error;b.prototype.constructor=Error;b.prototype.name="TimeoutError";l.TimeoutError=b;V.Promise=l});var X=p(T=>{T.validateOptions=function(r,t,n){if(r){var o=r?Object.keys(r):[],u=o.find(i=>!t.includes(i));if(u)throw new Error('Object "'+n+'" contains an unknown option "'+u+'"');var c=t.find(i=>Object.prototype[i]&&!o.includes(i));if(c)throw new Error('Object "'+n+'" contains an inherited option "'+c+'" which is not defined in the object itself but in its prototype. Only plain objects are allowed. Please remove the option from the prototype or override it with a value "undefined".');return r}};T.workerOptsNames=["credentials","name","type"];T.forkOptsNames=["cwd","detached","env","execPath","execArgv","gid","serialization","signal","killSignal","silent","stdio","uid","windowsVerbatimArguments","timeout"];T.workerThreadOptsNames=["argv","env","eval","execArgv","stdin","stdout","stderr","workerData","trackUnmanagedFds","transferList","resourceLimits","name"]});var Y=p((tr,K)=>{K.exports=`!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).worker=n()}(this,(function(){"use strict";function e(n){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(n)}function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var t={};var r=function(e,n){this.message=e,this.transfer=n},o={};function i(e,n){var t=this;if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if("function"!=typeof e)throw new SyntaxError("Function parameter handler(resolve, reject) missing");var r=[],o=[];this.resolved=!1,this.rejected=!1,this.pending=!0,this[Symbol.toStringTag]="Promise";var a=function(e,n){r.push(e),o.push(n)};this.then=function(e,n){return new i((function(t,r){var o=e?s(e,t,r):t,i=n?s(n,t,r):r;a(o,i)}),t)};var f=function(e){return t.resolved=!0,t.rejected=!1,t.pending=!1,r.forEach((function(n){n(e)})),a=function(n,t){n(e)},f=d=function(){},t},d=function(e){return t.resolved=!1,t.rejected=!0,t.pending=!1,o.forEach((function(n){n(e)})),a=function(n,t){t(e)},f=d=function(){},t};this.cancel=function(){return n?n.cancel():d(new u),t},this.timeout=function(e){if(n)n.timeout(e);else{var r=setTimeout((function(){d(new c("Promise timed out after "+e+" ms"))}),e);t.always((function(){clearTimeout(r)}))}return t},e((function(e){f(e)}),(function(e){d(e)}))}function s(e,n,t){return function(r){try{var o=e(r);o&&"function"==typeof o.then&&"function"==typeof o.catch?o.then(n,t):n(o)}catch(e){t(e)}}}function u(e){this.message=e||"promise cancelled",this.stack=(new Error).stack}function c(e){this.message=e||"timeout exceeded",this.stack=(new Error).stack}return i.prototype.catch=function(e){return this.then(null,e)},i.prototype.always=function(e){return this.then(e,e)},i.prototype.finally=function(e){var n=this,t=function(){return new i((function(e){return e()})).then(e).then((function(){return n}))};return this.then(t,t)},i.all=function(e){return new i((function(n,t){var r=e.length,o=[];r?e.forEach((function(e,i){e.then((function(e){o[i]=e,0==--r&&n(o)}),(function(e){r=0,t(e)}))})):n(o)}))},i.defer=function(){var e={};return e.promise=new i((function(n,t){e.resolve=n,e.reject=t})),e},u.prototype=new Error,u.prototype.constructor=Error,u.prototype.name="CancellationError",i.CancellationError=u,c.prototype=new Error,c.prototype.constructor=Error,c.prototype.name="TimeoutError",i.TimeoutError=c,o.Promise=i,function(n){var t=r,i=o.Promise,s="__workerpool-cleanup__",u={exit:function(){}},c={addAbortListener:function(e){u.abortListeners.push(e)},emit:u.emit};if("undefined"!=typeof self&&"function"==typeof postMessage&&"function"==typeof addEventListener)u.on=function(e,n){addEventListener(e,(function(e){n(e.data)}))},u.send=function(e,n){n?postMessage(e,n):postMessage(e)};else{if("undefined"==typeof process)throw new Error("Script must be executed as a worker");var a;try{a=require("worker_threads")}catch(n){if("object"!==e(n)||null===n||"MODULE_NOT_FOUND"!==n.code)throw n}if(a&&null!==a.parentPort){var f=a.parentPort;u.send=f.postMessage.bind(f),u.on=f.on.bind(f),u.exit=process.exit.bind(process)}else u.on=process.on.bind(process),u.send=function(e){process.send(e)},u.on("disconnect",(function(){process.exit(1)})),u.exit=process.exit.bind(process)}function d(e){return e&&e.toJSON?JSON.parse(JSON.stringify(e)):JSON.parse(JSON.stringify(e,Object.getOwnPropertyNames(e)))}function l(e){return e&&"function"==typeof e.then&&"function"==typeof e.catch}u.methods={},u.methods.run=function(e,n){var t=new Function("return ("+e+").apply(this, arguments);");return t.worker=c,t.apply(t,n)},u.methods.methods=function(){return Object.keys(u.methods)},u.terminationHandler=void 0,u.abortListenerTimeout=1e3,u.abortListeners=[],u.terminateAndExit=function(e){var n=function(){u.exit(e)};if(!u.terminationHandler)return n();var t=u.terminationHandler(e);return l(t)?(t.then(n,n),t):(n(),new i((function(e,n){n(new Error("Worker terminating"))})))},u.cleanup=function(e){if(!u.abortListeners.length)return u.send({id:e,method:s,error:d(new Error("Worker terminating"))}),new i((function(e){e()}));var n,t=u.abortListeners.map((function(e){return e()})),r=new i((function(e,t){n=setTimeout((function(){t(new Error("Timeout occured waiting for abort handler, killing worker"))}),u.abortListenerTimeout)})),o=i.all(t).then((function(){clearTimeout(n),u.abortListeners.length||(u.abortListeners=[])}),(function(){clearTimeout(n),u.exit()}));return new i((function(e,n){o.then(e,n),r.then(e,n)})).then((function(){u.send({id:e,method:s,error:null})}),(function(n){u.send({id:e,method:s,error:n?d(n):null})}))};var p=null;u.on("message",(function(e){if("__workerpool-terminate__"===e)return u.terminateAndExit(0);if(e.method===s)return u.cleanup(e.id);try{var n=u.methods[e.method];if(!n)throw new Error('Unknown method "'+e.method+'"');p=e.id;var r=n.apply(n,e.params);l(r)?r.then((function(n){n instanceof t?u.send({id:e.id,result:n.message,error:null},n.transfer):u.send({id:e.id,result:n,error:null}),p=null})).catch((function(n){u.send({id:e.id,result:null,error:d(n)}),p=null})):(r instanceof t?u.send({id:e.id,result:r.message,error:null},r.transfer):u.send({id:e.id,result:r,error:null}),p=null)}catch(n){u.send({id:e.id,result:null,error:d(n)})}})),u.register=function(e,n){if(e)for(var t in e)e.hasOwnProperty(t)&&(u.methods[t]=e[t],u.methods[t].worker=c);n&&(u.terminationHandler=n.onTerminate,u.abortListenerTimeout=n.abortListenerTimeout||1e3),u.send("ready")},u.emit=function(e){if(p){if(e instanceof t)return void u.send({id:p,isEvent:!0,payload:e.message},e.transfer);u.send({id:p,isEvent:!0,payload:e})}},n.add=u.register,n.emit=u.emit}(t),n(t)}));
//# sourceMappingURL=worker.min.js.map
`});var ue=p((nr,w)=>{"use strict";var{Promise:E}=O(),ne=S(),{validateOptions:q,forkOptsNames:Pe,workerThreadOptsNames:Ne,workerOptsNames:Me}=X(),Z="__workerpool-terminate__",oe="__workerpool-cleanup__";function ie(){var e=H();if(!e)throw new Error("WorkerPool: workerType = 'thread' is not supported, Node >= 11.7.0 required");return e}function $(){if(typeof Worker!="function"&&(typeof Worker!="object"||typeof Worker.prototype.constructor!="function"))throw new Error("WorkerPool: Web Workers not supported")}function H(){try{return require("worker_threads")}catch(e){if(typeof e=="object"&&e!==null&&e.code==="MODULE_NOT_FOUND")return null;throw e}}function Ue(){if(ne.platform==="browser"){if(typeof Blob>"u")throw new Error("Blob not supported by the browser");if(!window.URL||typeof window.URL.createObjectURL!="function")throw new Error("URL.createObjectURL not supported by the browser");var e=new Blob([Y()],{type:"text/javascript"});return window.URL.createObjectURL(e)}else return __dirname+"/worker.js"}function qe(e,r){if(r.workerType==="web")return $(),N(e,r.workerOpts,Worker);if(r.workerType==="thread")return t=ie(),M(e,t,r);if(r.workerType==="process"||!r.workerType)return U(e,ee(r),require("child_process"));if(ne.platform==="browser")return $(),N(e,r.workerOpts,Worker);var t=H();return t?M(e,t,r):U(e,ee(r),require("child_process"))}function N(e,r,t){q(r,Me,"workerOpts");var n=new t(e,r);return n.isBrowserWorker=!0,n.on=function(o,u){this.addEventListener(o,function(c){u(c.data)})},n.send=function(o,u){this.postMessage(o,u)},n}function M(e,r,t){q(t?.workerThreadOpts,Ne,"workerThreadOpts");var n=new r.Worker(e,{stdout:t?.emitStdStreams??!1,stderr:t?.emitStdStreams??!1,...t?.workerThreadOpts});return n.isWorkerThread=!0,n.send=function(o,u){this.postMessage(o,u)},n.kill=function(){return this.terminate(),!0},n.disconnect=function(){this.terminate()},t?.emitStdStreams&&(n.stdout.on("data",o=>n.emit("stdout",o)),n.stderr.on("data",o=>n.emit("stderr",o))),n}function U(e,r,t){q(r.forkOpts,Pe,"forkOpts");var n=t.fork(e,r.forkArgs,r.forkOpts),o=n.send;return n.send=function(u){return o.call(n,u)},r.emitStdStreams&&(n.stdout.on("data",u=>n.emit("stdout",u)),n.stderr.on("data",u=>n.emit("stderr",u))),n.isChildProcess=!0,n}function ee(e){e=e||{};var r=process.execArgv.join(" "),t=r.indexOf("--inspect")!==-1,n=r.indexOf("--debug-brk")!==-1,o=[];return t&&(o.push("--inspect="+e.debugPort),n&&o.push("--debug-brk")),process.execArgv.forEach(function(u){u.indexOf("--max-old-space-size")>-1&&o.push(u)}),Object.assign({},e,{forkArgs:e.forkArgs,forkOpts:Object.assign({},e.forkOpts,{execArgv:(e.forkOpts&&e.forkOpts.execArgv||[]).concat(o),stdio:e.emitStdStreams?"pipe":void 0})})}function re(e){for(var r=new Error(""),t=Object.keys(e),n=0;n<t.length;n++)r[t[n]]=e[t[n]];return r}function te(e,r){Object.values(e.processing).forEach(t=>t?.options?.on(r)),Object.values(e.tracking).forEach(t=>t?.options?.on(r))}function g(e,r){var t=this,n=r||{};this.script=e||Ue(),this.worker=qe(this.script,n),this.debugPort=n.debugPort,this.forkOpts=n.forkOpts,this.forkArgs=n.forkArgs,this.workerOpts=n.workerOpts,this.workerThreadOpts=n.workerThreadOpts,this.workerTerminateTimeout=n.workerTerminateTimeout,e||(this.worker.ready=!0),this.requestQueue=[],this.worker.on("stdout",function(i){te(t,{stdout:i.toString()})}),this.worker.on("stderr",function(i){te(t,{stderr:i.toString()})}),this.worker.on("message",function(i){if(!t.terminated)if(typeof i=="string"&&i==="ready")t.worker.ready=!0,u();else{var a=i.id,f=t.processing[a];if(f!==void 0)i.isEvent?f.options&&typeof f.options.on=="function"&&f.options.on(i.payload):(delete t.processing[a],t.terminating===!0&&t.terminate(),i.error?f.resolver.reject(re(i.error)):f.resolver.resolve(i.result));else{var f=t.tracking[a];f!==void 0&&i.isEvent&&f.options&&typeof f.options.on=="function"&&f.options.on(i.payload)}if(i.method===oe){var d=t.tracking[i.id];d!==void 0&&(i.error?(clearTimeout(d.timeoutId),d.resolver.reject(re(i.error))):(t.tracking&&clearTimeout(d.timeoutId),d.resolver.reject(new se(d.error)))),delete t.tracking[a]}}});function o(i){t.terminated=!0;for(var a in t.processing)t.processing[a]!==void 0&&t.processing[a].resolver.reject(i);t.processing=Object.create(null)}function u(){for(let i of t.requestQueue.splice(0))t.worker.send(i.message,i.transfer)}var c=this.worker;this.worker.on("error",o),this.worker.on("exit",function(i,a){var f=`Workerpool Worker terminated Unexpectedly
`;f+="    exitCode: `"+i+"`\n",f+="    signalCode: `"+a+"`\n",f+="    workerpool.script: `"+t.script+"`\n",f+="    spawnArgs: `"+c.spawnargs+"`\n",f+="    spawnfile: `"+c.spawnfile+"`\n",f+="    stdout: `"+c.stdout+"`\n",f+="    stderr: `"+c.stderr+"`\n",o(new Error(f))}),this.processing=Object.create(null),this.tracking=Object.create(null),this.terminating=!1,this.terminated=!1,this.cleaning=!1,this.terminationHandler=null,this.lastId=0}g.prototype.methods=function(){return this.exec("methods")};g.prototype.exec=function(e,r,t,n){t||(t=E.defer());var o=++this.lastId;this.processing[o]={id:o,resolver:t,options:n};var u={message:{id:o,method:e,params:r},transfer:n&&n.transfer};this.terminated?t.reject(new Error("Worker is terminated")):this.worker.ready?this.worker.send(u.message,u.transfer):this.requestQueue.push(u);var c=this;return t.promise.catch(function(i){if(i instanceof E.CancellationError||i instanceof E.TimeoutError)return c.tracking[o]={id:o,resolver:E.defer(),options:n,error:i},delete c.processing[o],c.tracking[o].resolver.promise=c.tracking[o].resolver.promise.catch(function(a){if(delete c.tracking[o],a instanceof se)throw a.error;var f=c.terminateAndNotify(!0).then(function(){throw a},function(d){throw d});return f}),c.worker.send({id:o,method:oe}),c.tracking[o].timeoutId=setTimeout(function(){c.tracking[o].resolver.reject(i)},c.workerTerminateTimeout),c.tracking[o].resolver.promise;throw i})};g.prototype.busy=function(){return this.cleaning||Object.keys(this.processing).length>0};g.prototype.terminate=function(e,r){var t=this;if(e){for(var n in this.processing)this.processing[n]!==void 0&&this.processing[n].resolver.reject(new Error("Worker terminated"));this.processing=Object.create(null)}for(var o of Object.values(t.tracking))clearTimeout(o.timeoutId),o.resolver.reject(new Error("Worker Terminating"));if(t.tracking=Object.create(null),typeof r=="function"&&(this.terminationHandler=r),this.busy())this.terminating=!0;else{var u=function(i){if(t.terminated=!0,t.cleaning=!1,t.worker!=null&&t.worker.removeAllListeners&&t.worker.removeAllListeners("message"),t.worker=null,t.terminating=!1,t.terminationHandler)t.terminationHandler(i,t);else if(i)throw i};if(this.worker)if(typeof this.worker.kill=="function"){if(this.worker.killed){u(new Error("worker already killed!"));return}var c=setTimeout(function(){t.worker&&t.worker.kill()},this.workerTerminateTimeout);this.worker.once("exit",function(){clearTimeout(c),t.worker&&(t.worker.killed=!0),u()}),this.worker.ready?this.worker.send(Z):this.requestQueue.push({message:Z}),this.cleaning=!0;return}else if(typeof this.worker.terminate=="function")this.worker.terminate(),this.worker.killed=!0;else throw new Error("Failed to terminate worker");u()}};g.prototype.terminateAndNotify=function(e,r){var t=E.defer();return r&&t.promise.timeout(r),this.terminate(e,function(n,o){n?t.reject(n):t.resolve(o)}),t.promise};function se(e){this.error=e,this.stack=new Error().stack}w.exports=g;w.exports._tryRequireWorkerThreads=H;w.exports._setupProcessWorker=U;w.exports._setupBrowserWorker=N;w.exports._setupWorkerThreadWorker=M;w.exports.ensureWorkerThreads=ie});var ce=p((or,fe)=>{"use strict";var ae=65535;fe.exports=D;function D(){this.ports=Object.create(null),this.length=0}D.prototype.nextAvailableStartingAt=function(e){for(;this.ports[e]===!0;)e++;if(e>=ae)throw new Error("WorkerPool debug port limit reached: "+e+">= "+ae);return this.ports[e]=!0,this.length++,e};D.prototype.releasePort=function(e){delete this.ports[e],this.length--}});var me=p((ir,pe)=>{var{Promise:C}=O(),de=ue(),He=S(),De=ce(),R=new De;function h(e,r){typeof e=="string"?this.script=e||null:(this.script=null,r=e),this.workers=[],this.tasks=[],r=r||{},this.forkArgs=Object.freeze(r.forkArgs||[]),this.forkOpts=Object.freeze(r.forkOpts||{}),this.workerOpts=Object.freeze(r.workerOpts||{}),this.workerThreadOpts=Object.freeze(r.workerThreadOpts||{}),this.debugPortStart=r.debugPortStart||43210,this.nodeWorker=r.nodeWorker,this.workerType=r.workerType||r.nodeWorker||"auto",this.maxQueueSize=r.maxQueueSize||1/0,this.workerTerminateTimeout=r.workerTerminateTimeout||1e3,this.onCreateWorker=r.onCreateWorker||(()=>null),this.onTerminateWorker=r.onTerminateWorker||(()=>null),this.emitStdStreams=r.emitStdStreams||!1,r&&"maxWorkers"in r?(Ce(r.maxWorkers),this.maxWorkers=r.maxWorkers):this.maxWorkers=Math.max((He.cpus||4)-1,1),r&&"minWorkers"in r&&(r.minWorkers==="max"?this.minWorkers=this.maxWorkers:(Re(r.minWorkers),this.minWorkers=r.minWorkers,this.maxWorkers=Math.max(this.minWorkers,this.maxWorkers)),this._ensureMinWorkers()),this._boundNext=this._next.bind(this),this.workerType==="thread"&&de.ensureWorkerThreads()}h.prototype.exec=function(e,r,t){if(r&&!Array.isArray(r))throw new TypeError('Array expected as argument "params"');if(typeof e=="string"){var n=C.defer();if(this.tasks.length>=this.maxQueueSize)throw new Error("Max queue size of "+this.maxQueueSize+" reached");var o=this.tasks,u={method:e,params:r,resolver:n,timeout:null,options:t};o.push(u);var c=n.promise.timeout;return n.promise.timeout=function(a){return o.indexOf(u)!==-1?(u.timeout=a,n.promise):c.call(n.promise,a)},this._next(),n.promise}else{if(typeof e=="function")return this.exec("run",[String(e),r],t);throw new TypeError('Function or string expected as argument "method"')}};h.prototype.proxy=function(){if(arguments.length>0)throw new Error("No arguments expected");var e=this;return this.exec("methods").then(function(r){var t={};return r.forEach(function(n){t[n]=function(){return e.exec(n,Array.prototype.slice.call(arguments))}}),t})};h.prototype._next=function(){if(this.tasks.length>0){var e=this._getWorker();if(e){var r=this,t=this.tasks.shift();if(t.resolver.promise.pending){var n=e.exec(t.method,t.params,t.resolver,t.options).then(r._boundNext).catch(function(){if(e.terminated)return r._removeWorker(e)}).then(function(){r._next()});typeof t.timeout=="number"&&n.timeout(t.timeout)}else r._next()}}};h.prototype._getWorker=function(){for(var e=this.workers,r=0;r<e.length;r++){var t=e[r];if(t.busy()===!1)return t}return e.length<this.maxWorkers?(t=this._createWorkerHandler(),e.push(t),t):null};h.prototype._removeWorker=function(e){var r=this;return R.releasePort(e.debugPort),this._removeWorkerFromList(e),this._ensureMinWorkers(),new C(function(t,n){e.terminate(!1,function(o){r.onTerminateWorker({forkArgs:e.forkArgs,forkOpts:e.forkOpts,workerThreadOpts:e.workerThreadOpts,script:e.script}),o?n(o):t(e)})})};h.prototype._removeWorkerFromList=function(e){var r=this.workers.indexOf(e);r!==-1&&this.workers.splice(r,1)};h.prototype.terminate=function(e,r){var t=this;this.tasks.forEach(function(i){i.resolver.reject(new Error("Pool terminated"))}),this.tasks.length=0;var n=function(i){R.releasePort(i.debugPort),this._removeWorkerFromList(i)},o=n.bind(this),u=[],c=this.workers.slice();return c.forEach(function(i){var a=i.terminateAndNotify(e,r).then(o).always(function(){t.onTerminateWorker({forkArgs:i.forkArgs,forkOpts:i.forkOpts,workerThreadOpts:i.workerThreadOpts,script:i.script})});u.push(a)}),C.all(u)};h.prototype.stats=function(){var e=this.workers.length,r=this.workers.filter(function(t){return t.busy()}).length;return{totalWorkers:e,busyWorkers:r,idleWorkers:e-r,pendingTasks:this.tasks.length,activeTasks:r}};h.prototype._ensureMinWorkers=function(){if(this.minWorkers)for(var e=this.workers.length;e<this.minWorkers;e++)this.workers.push(this._createWorkerHandler())};h.prototype._createWorkerHandler=function(){let e=this.onCreateWorker({forkArgs:this.forkArgs,forkOpts:this.forkOpts,workerOpts:this.workerOpts,workerThreadOpts:this.workerThreadOpts,script:this.script})||{};return new de(e.script||this.script,{forkArgs:e.forkArgs||this.forkArgs,forkOpts:e.forkOpts||this.forkOpts,workerOpts:e.workerOpts||this.workerOpts,workerThreadOpts:e.workerThreadOpts||this.workerThreadOpts,debugPort:R.nextAvailableStartingAt(this.debugPortStart),workerType:this.workerType,workerTerminateTimeout:this.workerTerminateTimeout,emitStdStreams:this.emitStdStreams})};function Ce(e){if(!le(e)||!he(e)||e<1)throw new TypeError("Option maxWorkers must be an integer number >= 1")}function Re(e){if(!le(e)||!he(e)||e<0)throw new TypeError("Option minWorkers must be an integer number >= 0")}function le(e){return typeof e=="number"}function he(e){return Math.round(e)==e}pe.exports=h});var F=p((sr,ke)=>{function Fe(e,r){this.message=e,this.transfer=r}ke.exports=Fe});var J=p(A=>{var I=F(),_=O().Promise,Ie="__workerpool-terminate__",j="__workerpool-cleanup__",we=1e3,s={exit:function(){}},ve={addAbortListener:function(e){s.abortListeners.push(e)},emit:s.emit};if(typeof self<"u"&&typeof postMessage=="function"&&typeof addEventListener=="function")s.on=function(e,r){addEventListener(e,function(t){r(t.data)})},s.send=function(e,r){r?postMessage(e,r):postMessage(e)};else if(typeof process<"u"){try{x=require("worker_threads")}catch(e){if(!(typeof e=="object"&&e!==null&&e.code==="MODULE_NOT_FOUND"))throw e}x&&x.parentPort!==null?(W=x.parentPort,s.send=W.postMessage.bind(W),s.on=W.on.bind(W),s.exit=process.exit.bind(process)):(s.on=process.on.bind(process),s.send=function(e){process.send(e)},s.on("disconnect",function(){process.exit(1)}),s.exit=process.exit.bind(process))}else throw new Error("Script must be executed as a worker");var x,W;function L(e){return e&&e.toJSON?JSON.parse(JSON.stringify(e)):JSON.parse(JSON.stringify(e,Object.getOwnPropertyNames(e)))}function ge(e){return e&&typeof e.then=="function"&&typeof e.catch=="function"}s.methods={};s.methods.run=function(r,t){var n=new Function("return ("+r+").apply(this, arguments);");return n.worker=ve,n.apply(n,t)};s.methods.methods=function(){return Object.keys(s.methods)};s.terminationHandler=void 0;s.abortListenerTimeout=we;s.abortListeners=[];s.terminateAndExit=function(e){var r=function(){s.exit(e)};if(!s.terminationHandler)return r();var t=s.terminationHandler(e);return ge(t)?(t.then(r,r),t):(r(),new _(function(n,o){o(new Error("Worker terminating"))}))};s.cleanup=function(e){if(!s.abortListeners.length)return s.send({id:e,method:j,error:L(new Error("Worker terminating"))}),new _(function(i){i()});var r=function(){s.exit()},t=function(){s.abortListeners.length||(s.abortListeners=[])};let n=s.abortListeners.map(i=>i()),o,u=new _((i,a)=>{o=setTimeout(function(){a(new Error("Timeout occured waiting for abort handler, killing worker"))},s.abortListenerTimeout)}),c=_.all(n).then(function(){clearTimeout(o),t()},function(){clearTimeout(o),r()});return new _(function(i,a){c.then(i,a),u.then(i,a)}).then(function(){s.send({id:e,method:j,error:null})},function(i){s.send({id:e,method:j,error:i?L(i):null})})};var v=null;s.on("message",function(e){if(e===Ie)return s.terminateAndExit(0);if(e.method===j)return s.cleanup(e.id);try{var r=s.methods[e.method];if(r){v=e.id;var t=r.apply(r,e.params);ge(t)?t.then(function(n){n instanceof I?s.send({id:e.id,result:n.message,error:null},n.transfer):s.send({id:e.id,result:n,error:null}),v=null}).catch(function(n){s.send({id:e.id,result:null,error:L(n)}),v=null}):(t instanceof I?s.send({id:e.id,result:t.message,error:null},t.transfer):s.send({id:e.id,result:t,error:null}),v=null)}else throw new Error('Unknown method "'+e.method+'"')}catch(n){s.send({id:e.id,result:null,error:L(n)})}});s.register=function(e,r){if(e)for(var t in e)e.hasOwnProperty(t)&&(s.methods[t]=e[t],s.methods[t].worker=ve);r&&(s.terminationHandler=r.onTerminate,s.abortListenerTimeout=r.abortListenerTimeout||we),s.send("ready")};s.emit=function(e){if(v){if(e instanceof I){s.send({id:v,isEvent:!0,payload:e.message},e.transfer);return}s.send({id:v,isEvent:!0,payload:e})}};typeof A<"u"&&(A.add=s.register,A.emit=s.emit)});var ye=p(m=>{var{platform:Je,isMainThread:ze,cpus:Be}=S();function Qe(e,r){var t=me();return new t(e,r)}m.pool=Qe;function Ge(e,r){var t=J();t.add(e,r)}m.worker=Ge;function Ve(e){var r=J();r.emit(e)}m.workerEmit=Ve;var{Promise:Xe}=O();m.Promise=Xe;m.Transfer=F();m.platform=Je;m.isMainThread=ze;m.cpus=Be});var be=Le(ye());function Oe(e,r){return r&&r.type==="Buffer"?Buffer.from(r.data):r}function Ke(e,r=!0){return JSON.parse(e,r?Oe:void 0)}function Ye(e){return JSON.stringify(e)}be.default.worker({parseJSON:Ke,stringifyJSON:Ye,bufferReviver:Oe});
